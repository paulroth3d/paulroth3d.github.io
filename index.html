<!DOCTYPE HTML>

<html><head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    <meta charset="utf-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Useful Bookmarklets</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" rel="stylesheet" />
    
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <style type="text/css">
    .center {
         float: none;
         margin-left: auto;
         margin-right: auto;
    }
    </style>
  </head>
  <body>
    
	<!--
	SWEET! YOU ARE LOOKING AT THE CODE.
    
	These are a bunch of additional bookmarklets that are helpful,
	but would require a bit of customizing to make them useful for you:
	
	Once you have the javascript updated, create your own bookmarklet at:
	http://ted.mielczarek.org/code/mozilla/bookmarklet.html
	
	
    Find a particular user:
    (works in SF1, standard salesforce and LEX:
    
    javascript: (function() {
	var whichType = prompt('Which user should we use?\n\n' + '(NOTE: types in parentheses or 0-5 work)\n\n' + '0: (type1) Jane Doe\n' + '1: (type2) John Doh\n'\n');
	var userId = null;
	if (window.location.href.indexOf('/lne--dev0') & gt; 0) {
		switch (whichType) {
			case 'jane':
			case 'doe':
			case '0':
			case 'type1':
				userId = '005R00000026DCp';
				break;
			case 'john':
			case 'doh':
			case '1':
			case 'type2':
				userId = '005R0000002OPhH';
				break;
			default:
				alert('Did not understand:' + whichType + '. Please try again');
				break;
		}
	} else if (window.location.href.indexOf('/something') & gt; 0) {
		switch (whichType) {
			case 'jane':
			case 'doe':
			case '0':
			case 'type1':
				userId = '005R00000026DCp';
				break;
			case 'john':
			case 'doh':
			case '1':
			case 'type2':
				userId = '005R0000002OPhH';
				break;
			default:
				alert('Did not understand:' + whichType + '. Please try again');
				break;
		}
	} else {
		alert('Unknown domain');
	}
	if (userId) {
		var url = window.location.protocol + '//' + window.location.host + '/' + userId + '?noredirect=1';
		window.open(url, '_blank');
	}
	})();
	
	//-- actually logs in as the user - similar to the one above:
	javascript: (function() {
		var whichType = prompt('Which user should we use?\n\n' + '(NOTE: types in parentheses or 0-5 work)\n\n' + '0: (type1) Jane Doe\n' + '1: (type2) John Doh\n'\n');
	var userId = null;
		var orgId = null;
		if (window.location.href.indexOf('/org1Indicator') & gt; 0) {
			orgId = 'salesforceIdOfOrg1'; // used in the redirect
			switch (whichType) {
				case 'jane':
				case 'doe':
				case '0':
				case 'type1':
					userId = '005R00000026DCp';
					break;
				case 'john':
				case 'doh':
				case '1':
				case 'type2':
					userId = '005R0000002OPhH';
					break;
				default:
					alert('Did not understand:' + whichType + '. Please try again');
					break;
			}
		} else if (window.location.href.indexOf('/lne--qa0') & gt; 0) {
			orgId = '00D6C0000000MTC';
			switch (whichType) {
				case 'jane':
				case 'doe':
				case '0':
				case 'type1':
					userId = '005R00000026DCp';
					break;
				case 'john':
				case 'doh':
				case '1':
				case 'type2':
					userId = '005R0000002OPhH';
					break;
				default:
					alert('Did not understand:' + whichType + '. Please try again');
					break;
			}
		} else {
			alert('Unknown domain');
		}
		if (userId) {
			var url = window.location.protocol + '//' + window.location.host + '/servlet/servlet.su?oid=' + orgId + '&amp;suorgadminid=' + userId + '&amp;targetURL=%2Fhome%2Fhome.jsp&amp;retURL=%2F005%3FisUserEntityOverride%3D1%26retURL%3D%252Fsetup%252Fhome%26isdtp%3Dp1%26sfdcIFrameOrigin%3Dhttps%253A%252F%252F' + window.location.host + '%26sfdcIFrameHost%3Dweb';
			window.open(url, '_blank');
		}
	})();
	-->

    
    
    <div class="jumbotron">
        <a id="TURNDOWN_SELECTION" name="TURNDOWN_SELECTION"></a>
        <div class="container">
            <h1><a href="#TURNDOWN_SELECTION">Turndown Selection</a></h1>
            <p>Copies a selection on any webpage to Markdown into your clipboard<br />
             - for use in your own note taking</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet and enter your search term</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){function%20copyRich(text)%20%7B%0A%20%20const%20cb%20=%20(evt)%20=>%20%7B%0A%20%20evt.clipboardData.setData('text/plain',%20text)%3B%0A%20%20evt.preventDefault()%3B%0A%20%20%7D%0A%20%20document.addEventListener('copy',%20cb)%3B%0A%20%20document.execCommand('copy')%3B%0A%20%20document.removeEventListener('copy',%20cb)%3B%0A%7D%0A%0Afunction%20addScriptContents(uuid,%20scriptContents)%20%7B%0A%20%20const%20root%20=%20(window%20||%20globalThis)%3B%0A%20%20if%20(!root.loadedScripts)%20root.loadedScripts%20=%20new%20Map()%3B%0A%0A%20%20if%20(root.loadedScripts.has(uuid))%20%7B%0A%20%20return%20Promise.resolve(root.loadedScripts.get(uuid))%3B%0A%20%20%7D%0A%20%20%0A%20%20const%20cleanedScript%20=%20atob(scriptContents)%3B%0A%20%20const%20result%20=%20eval(cleanedScript)%3B%0A%20%20console.log(%60loaded:%20$%7Buuid%7D%60)%3B%0A%0A%20%20root.loadedScripts.set(uuid,%20result)%3B%0A%20%20%0A%20%20return%20Promise.resolve(result)%3B%0A%7D%0A%0Afunction%20turndownMain()%20%7B%0A%20%20return%20addTurndownGfm().then(%20()%20=>%20%7B%0A%20%20const%20sel%20=%20window.getSelection()%3B%0A%0A%20%20const%20selectionContents%20=%20new%20Array(sel.rangeCount).fill()%0A%20%20.map((i)%20=>%20%7B%0A%20%20const%20range%20=%20sel.getRangeAt(i)%3B%0A%20%20const%20frag%20=%20range.cloneContents()%3B%0A%20%20return%20globalThis.turndownService%3F.turndown(frag)%3B%0A%20%20%7D)%0A%20%20.filter((s)%20=>%20s)%3B%0A%0A%20%20const%20title%20=%20%60#%20$%7Bdocument.title%7D%60%3B%0A%20%20const%20address%20=%20document.location.href%3B%0A%0A%20%20const%20results%20=%20%60$%7Btitle%7D\n$%7Baddress%7D\n\n$%7BselectionContents.join('\n\n')%7D%60%3B%0A%20%20copyRich(results)%3B%0A%20%20console.log(results)%3B%0A%20%20window.alert('Markdown%20Added%20to%20Clipboard')%3B%0A%20%20%7D%0A%20%20).catch(%20(err)%20=>%20%7B%0A%20%20window.alert('Error%20occurred')%3B%0A%20%20console.error(%60error%20occurred:%20$%7Berr.message%7D%60)%3B%0A%20%20debugger%20%3B%0A%20%20%7D%0A%20%20)%3B%0A%7D%0A%0Afunction%20addTurndownGfm()%20%7B%0A%20%20return%20addTurndown().then(%20()%20=>%20%7B%0A%20%20//--%20include%20the%20following%20in%20your%20code%0A%20%20return%20addScriptContents('npm-turndown-gfm',%20'CnZhciBUdXJuZG93blBsdWdpbkdmbVNlcnZpY2UgPSAoZnVuY3Rpb24gKGV4cG9ydHMpIHsKICAndXNlIHN0cmljdCc7CgogIHZhciBoaWdobGlnaHRSZWdFeHAgPSAvaGlnaGxpZ2h0LSg/OnRleHR8c291cmNlKS0oW2EtejAtOV0rKS87CgogIGZ1bmN0aW9uIGhpZ2hsaWdodGVkQ29kZUJsb2NrICh0dXJuZG93blNlcnZpY2UpIHsKICAgIHR1cm5kb3duU2VydmljZS5hZGRSdWxlKCdoaWdobGlnaHRlZENvZGVCbG9jaycsIHsKICAgICAgZmlsdGVyOiBmdW5jdGlvbiAobm9kZSkgewogICAgICAgIHZhciBmaXJzdENoaWxkID0gbm9kZS5maXJzdENoaWxkOwogICAgICAgIHJldHVybiAoCiAgICAgICAgICBub2RlLm5vZGVOYW1lID09PSAnRElWJyAmJgogICAgICAgICAgaGlnaGxpZ2h0UmVnRXhwLnRlc3Qobm9kZS5jbGFzc05hbWUpICYmCiAgICAgICAgICBmaXJzdENoaWxkICYmCiAgICAgICAgICBmaXJzdENoaWxkLm5vZGVOYW1lID09PSAnUFJFJwogICAgICAgICkKICAgICAgfSwKICAgICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlLCBvcHRpb25zKSB7CiAgICAgICAgdmFyIGNsYXNzTmFtZSA9IG5vZGUuY2xhc3NOYW1lIHx8ICcnOwogICAgICAgIHZhciBsYW5ndWFnZSA9IChjbGFzc05hbWUubWF0Y2goaGlnaGxpZ2h0UmVnRXhwKSB8fCBbbnVsbCwgJyddKVsxXTsKCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICdcblxuJyArIG9wdGlvbnMuZmVuY2UgKyBsYW5ndWFnZSArICdcbicgKwogICAgICAgICAgbm9kZS5maXJzdENoaWxkLnRleHRDb250ZW50ICsKICAgICAgICAgICdcbicgKyBvcHRpb25zLmZlbmNlICsgJ1xuXG4nCiAgICAgICAgKQogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHN0cmlrZXRocm91Z2ggKHR1cm5kb3duU2VydmljZSkgewogICAgdHVybmRvd25TZXJ2aWNlLmFkZFJ1bGUoJ3N0cmlrZXRocm91Z2gnLCB7CiAgICAgIGZpbHRlcjogWydkZWwnLCAncycsICdzdHJpa2UnXSwKICAgICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50KSB7CiAgICAgICAgcmV0dXJuICd+JyArIGNvbnRlbnQgKyAnficKICAgICAgfQogICAgfSk7CiAgfQoKICB2YXIgaW5kZXhPZiA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mOwogIHZhciBydWxlcyA9IHt9OwoKICBydWxlcy50YWJsZUNlbGwgPSB7CiAgICBmaWx0ZXI6IFsndGgnLCAndGQnXSwKICAgIHJlcGxhY2VtZW50OiBmdW5jdGlvbiAoY29udGVudCwgbm9kZSkgewogICAgICByZXR1cm4gY2VsbChjb250ZW50LCBub2RlKSArIHNwYW5uZWRDZWxscyhub2RlLCAnJykKICAgIH0KICB9OwoKICBydWxlcy50YWJsZVJvdyA9IHsKICAgIGZpbHRlcjogJ3RyJywKICAgIHJlcGxhY2VtZW50OiBmdW5jdGlvbiAoY29udGVudCwgbm9kZSkgewogICAgICB2YXIgYm9yZGVyQ2VsbHMgPSAnJzsKICAgICAgdmFyIGFsaWduTWFwID0geyBsZWZ0OiAnOi0tJywgcmlnaHQ6ICctLTonLCBjZW50ZXI6ICc6LTonIH07CgogICAgICBpZiAoaXNIZWFkaW5nUm93KG5vZGUpKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBib3JkZXIgPSAnLS0tJzsKICAgICAgICAgIHZhciBhbGlnbiA9ICgKICAgICAgICAgICAgbm9kZS5jaGlsZE5vZGVzW2ldLmdldEF0dHJpYnV0ZSgnYWxpZ24nKSB8fCAnJwogICAgICAgICAgKS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICAgIGlmIChhbGlnbikgYm9yZGVyID0gYWxpZ25NYXBbYWxpZ25dIHx8IGJvcmRlcjsKCiAgICAgICAgICBib3JkZXJDZWxscyArPSBjZWxsKGJvcmRlciwgbm9kZS5jaGlsZE5vZGVzW2ldKSArIHNwYW5uZWRDZWxscyhub2RlLmNoaWxkTm9kZXNbaV0sIGJvcmRlcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiAnXG4nICsgY29udGVudCArIChib3JkZXJDZWxscyA/ICdcbicgKyBib3JkZXJDZWxscyA6ICcnKQogICAgfQogIH07CgogIHJ1bGVzLnRhYmxlID0gewogICAgLy8gT25seSBjb252ZXJ0IHRhYmxlcyB0aGF0IGFyZSBub3QgbmVzdGVkIGluIGFub3RoZXIgdGFibGUsIHRoZXkgYXJlIGtlcHQgdXNpbmcgYGtlZXBgIChzZWUgYmVsb3cpLgogICAgLy8gVE9ETzogbmVzdGVkIHRhYmxlcyBzaG91bGQgYmUgY29udmVydGVkIHRvIHBsYWluIHRleHQgaW4gYSBzdHJpY3QgKG5vbiBIVE1MKSBnZm0KICAgIGZpbHRlcjogZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgcmV0dXJuIG5vZGUubm9kZU5hbWUgPT09ICdUQUJMRScgJiYgIWlzTmVzdGVkVGFibGUobm9kZSkKICAgIH0sCgogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50KSB7CiAgICAgIC8vIEVuc3VyZSB0aGVyZSBhcmUgbm8gYmxhbmsgbGluZXMKICAgICAgY29udGVudCA9IGNvbnRlbnQucmVwbGFjZSgnXG5cbicsICdcbicpOwogICAgICByZXR1cm4gJ1xuXG4nICsgY29udGVudCArICdcblxuJwogICAgfQogIH07CgogIHJ1bGVzLnRhYmxlU2VjdGlvbiA9IHsKICAgIGZpbHRlcjogWyd0aGVhZCcsICd0Ym9keScsICd0Zm9vdCddLAogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50KSB7CiAgICAgIHJldHVybiBjb250ZW50CiAgICB9CiAgfTsKCiAgcnVsZXMuY2FwdGlvblNlY3Rpb24gPSB7CiAgICAvLyBvbmx5IHJldHVybiBjb250ZW50IGlmIGNhcHRpb24gaWYgdGhlIGZpcnN0IG5vZGUgaW1tZWRpYXRlbHkgYWZ0ZXIgVEFCTEUKICAgIGZpbHRlcjogJ2NhcHRpb24nLAogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlKSB7CiAgICAgIGlmIChub2RlLnBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdUQUJMRScgJiYgbm9kZS5wYXJlbnROb2RlLmNoaWxkTm9kZXNbMF0gPT09IG5vZGUpIHJldHVybiBjb250ZW50CiAgICAgIHJldHVybiAnJwogICAgfQogIH07CgogIGZ1bmN0aW9uIGlzSGVhZGluZ1JvdyAodHIpIHsKICAgIHZhciBwYXJlbnROb2RlID0gdHIucGFyZW50Tm9kZTsKICAgIHZhciB0YWJsZU5vZGUgPSBwYXJlbnROb2RlOwogICAgaWYgKHBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdUSEVBRCcgfHwKICAgICAgIHBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdURk9PVCcgfHwKICAgICAgIHBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdUQk9EWScpIHsKICAgICAgdGFibGVOb2RlID0gcGFyZW50Tm9kZS5wYXJlbnROb2RlOwogICAgfQogICAgcmV0dXJuICh0YWJsZU5vZGUubm9kZU5hbWUgPT09ICdUQUJMRScgJiYgdGFibGVOb2RlLnJvd3NbMF0gPT09IHRyKQogIH0KCiAgZnVuY3Rpb24gY2VsbCAoY29udGVudCwgbm9kZSkgewogICAgdmFyIGluZGV4ID0gaW5kZXhPZi5jYWxsKG5vZGUucGFyZW50Tm9kZS5jaGlsZE5vZGVzLCBub2RlKTsKICAgIHZhciBwcmVmaXggPSAnICc7CiAgICBpZiAoaW5kZXggPT09IDApIHByZWZpeCA9ICd8ICc7CiAgICAvLyBFbnN1cmUgc2luZ2xlIGxpbmUgcGVyIGNlbGwgKGJvdGggd2luZG93cyBhbmQgdW5peCBFb0wpCiAgICAvLyBUT0RPOiBhbGxvdyBnZm0gbm9uLXN0cmljdCBtb2RlIHRvIHJlcGxhY2UgbmV3IGxpbmVzIGJ5IGA8YnIvPmAKICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoL1xyXG4vZywgJ1xuJykucmVwbGFjZSgvXG4vZywgJyAnKTsKICAgIC8vIHwgbXVzdCBiZSBlc2NhcGVkIGFzIFx8CiAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKC9cfC9nLCAnXFx8Jyk7CiAgICByZXR1cm4gcHJlZml4ICsgY29udGVudCArICcgfCcKICB9CgogIGZ1bmN0aW9uIHNwYW5uZWRDZWxscyAobm9kZSwgc3Bhbm5lZENlbGxDb250ZW50KSB7CiAgICB2YXIgY29sc3BhbiA9IG5vZGUuZ2V0QXR0cmlidXRlKCdjb2xzcGFuJykgfHwgMTsKICAgIGlmIChjb2xzcGFuIDw9IDEpIHJldHVybiAnJwogICAgcmV0dXJuICgnICcgKyBzcGFubmVkQ2VsbENvbnRlbnQgKyAnIHwnKS5yZXBlYXQoY29sc3BhbiAtIDEpCiAgfQoKICBmdW5jdGlvbiBpc05lc3RlZFRhYmxlICh0YWJsZU5vZGUpIHsKICAgIHZhciBjdXJyZW50Tm9kZSA9IHRhYmxlTm9kZS5wYXJlbnROb2RlOwogICAgd2hpbGUgKGN1cnJlbnROb2RlKSB7CiAgICAgIGlmIChjdXJyZW50Tm9kZS5ub2RlTmFtZSA9PT0gJ1RBQkxFJykgcmV0dXJuIHRydWUKICAgICAgY3VycmVudE5vZGUgPSBjdXJyZW50Tm9kZS5wYXJlbnROb2RlOwogICAgfQogICAgcmV0dXJuIGZhbHNlCiAgfQoKICBmdW5jdGlvbiB0YWJsZXMgKHR1cm5kb3duU2VydmljZSkgewogICAgdHVybmRvd25TZXJ2aWNlLmtlZXAoZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgcmV0dXJuIG5vZGUubm9kZU5hbWUgPT09ICdUQUJMRScgJiYgaXNOZXN0ZWRUYWJsZShub2RlKQogICAgfSk7CiAgICBmb3IgKHZhciBrZXkgaW4gcnVsZXMpIHR1cm5kb3duU2VydmljZS5hZGRSdWxlKGtleSwgcnVsZXNba2V5XSk7CiAgfQoKICBmdW5jdGlvbiB0YXNrTGlzdEl0ZW1zICh0dXJuZG93blNlcnZpY2UpIHsKICAgIHR1cm5kb3duU2VydmljZS5hZGRSdWxlKCd0YXNrTGlzdEl0ZW1zJywgewogICAgICBmaWx0ZXI6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgcmV0dXJuIG5vZGUudHlwZSA9PT0gJ2NoZWNrYm94JyAmJiBub2RlLnBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdMSScKICAgICAgfSwKICAgICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlKSB7CiAgICAgICAgcmV0dXJuIChub2RlLmNoZWNrZWQgPyAnW3hdJyA6ICdbIF0nKSArICcgJwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGdmbSAodHVybmRvd25TZXJ2aWNlKSB7CiAgICB0dXJuZG93blNlcnZpY2UudXNlKFsKICAgICAgaGlnaGxpZ2h0ZWRDb2RlQmxvY2ssCiAgICAgIHN0cmlrZXRocm91Z2gsCiAgICAgIHRhYmxlcywKICAgICAgdGFza0xpc3RJdGVtcwogICAgXSk7CiAgfQoKICBleHBvcnRzLmdmbSA9IGdmbTsKICBleHBvcnRzLmhpZ2hsaWdodGVkQ29kZUJsb2NrID0gaGlnaGxpZ2h0ZWRDb2RlQmxvY2s7CiAgZXhwb3J0cy5zdHJpa2V0aHJvdWdoID0gc3RyaWtldGhyb3VnaDsKICBleHBvcnRzLnRhYmxlcyA9IHRhYmxlczsKICBleHBvcnRzLnRhc2tMaXN0SXRlbXMgPSB0YXNrTGlzdEl0ZW1zOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwoKICByZXR1cm4gZXhwb3J0czsKCn0oe30pKTsKCih3aW5kb3cgfHwgZ2xvYmFsVGhpcykuVHVybmRvd25QbHVnaW5HZm1TZXJ2aWNlID0gVHVybmRvd25QbHVnaW5HZm1TZXJ2aWNlOw==').then(%20()%20=>%20%7B%0A%0A%20%20const%20root%20=%20(window%20||%20globalThis)%3B%0A%20%20root.TurndownPluginGfmService.gfm(root.turndownService)%3B%0A%20%20%7D%0A%20%20)%3B%0A%20%20%7D%0A%20%20)%3B%0A%20%20//--%20test%20code%20added%20here.%0A%7D%0A%0Afunction%20addTurndown()%20%7B%0A%20%20//--%20include%20the%20following%20in%20your%20code%0A%20%20return%20addScriptContents('npm-turndown',%20'CnZhciBUdXJuZG93blNlcnZpY2UgPSAoZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gZXh0ZW5kIChkZXN0aW5hdGlvbikgewogICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgIGlmIChzb3VyY2UuaGFzT3duUHJvcGVydHkoa2V5KSkgZGVzdGluYXRpb25ba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZGVzdGluYXRpb24KICB9CgogIGZ1bmN0aW9uIHJlcGVhdCAoY2hhcmFjdGVyLCBjb3VudCkgewogICAgcmV0dXJuIEFycmF5KGNvdW50ICsgMSkuam9pbihjaGFyYWN0ZXIpCiAgfQoKICBmdW5jdGlvbiB0cmltTGVhZGluZ05ld2xpbmVzIChzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvXlxuKi8sICcnKQogIH0KCiAgZnVuY3Rpb24gdHJpbVRyYWlsaW5nTmV3bGluZXMgKHN0cmluZykgewogICAgLy8gYXZvaWQgbWF0Y2gtYXQtZW5kIHJlZ2V4cCBib3R0bGVuZWNrLCBzZWUgIzM3MAogICAgdmFyIGluZGV4RW5kID0gc3RyaW5nLmxlbmd0aDsKICAgIHdoaWxlIChpbmRleEVuZCA+IDAgJiYgc3RyaW5nW2luZGV4RW5kIC0gMV0gPT09ICdcbicpIGluZGV4RW5kLS07CiAgICByZXR1cm4gc3RyaW5nLnN1YnN0cmluZygwLCBpbmRleEVuZCkKICB9CgogIHZhciBibG9ja0VsZW1lbnRzID0gWwogICAgJ0FERFJFU1MnLCAnQVJUSUNMRScsICdBU0lERScsICdBVURJTycsICdCTE9DS1FVT1RFJywgJ0JPRFknLCAnQ0FOVkFTJywKICAgICdDRU5URVInLCAnREQnLCAnRElSJywgJ0RJVicsICdETCcsICdEVCcsICdGSUVMRFNFVCcsICdGSUdDQVBUSU9OJywgJ0ZJR1VSRScsCiAgICAnRk9PVEVSJywgJ0ZPUk0nLCAnRlJBTUVTRVQnLCAnSDEnLCAnSDInLCAnSDMnLCAnSDQnLCAnSDUnLCAnSDYnLCAnSEVBREVSJywKICAgICdIR1JPVVAnLCAnSFInLCAnSFRNTCcsICdJU0lOREVYJywgJ0xJJywgJ01BSU4nLCAnTUVOVScsICdOQVYnLCAnTk9GUkFNRVMnLAogICAgJ05PU0NSSVBUJywgJ09MJywgJ09VVFBVVCcsICdQJywgJ1BSRScsICdTRUNUSU9OJywgJ1RBQkxFJywgJ1RCT0RZJywgJ1REJywKICAgICdURk9PVCcsICdUSCcsICdUSEVBRCcsICdUUicsICdVTCcKICBdOwoKICBmdW5jdGlvbiBpc0Jsb2NrIChub2RlKSB7CiAgICByZXR1cm4gaXMobm9kZSwgYmxvY2tFbGVtZW50cykKICB9CgogIHZhciB2b2lkRWxlbWVudHMgPSBbCiAgICAnQVJFQScsICdCQVNFJywgJ0JSJywgJ0NPTCcsICdDT01NQU5EJywgJ0VNQkVEJywgJ0hSJywgJ0lNRycsICdJTlBVVCcsCiAgICAnS0VZR0VOJywgJ0xJTksnLCAnTUVUQScsICdQQVJBTScsICdTT1VSQ0UnLCAnVFJBQ0snLCAnV0JSJwogIF07CgogIGZ1bmN0aW9uIGlzVm9pZCAobm9kZSkgewogICAgcmV0dXJuIGlzKG5vZGUsIHZvaWRFbGVtZW50cykKICB9CgogIGZ1bmN0aW9uIGhhc1ZvaWQgKG5vZGUpIHsKICAgIHJldHVybiBoYXMobm9kZSwgdm9pZEVsZW1lbnRzKQogIH0KCiAgdmFyIG1lYW5pbmdmdWxXaGVuQmxhbmtFbGVtZW50cyA9IFsKICAgICdBJywgJ1RBQkxFJywgJ1RIRUFEJywgJ1RCT0RZJywgJ1RGT09UJywgJ1RIJywgJ1REJywgJ0lGUkFNRScsICdTQ1JJUFQnLAogICAgJ0FVRElPJywgJ1ZJREVPJwogIF07CgogIGZ1bmN0aW9uIGlzTWVhbmluZ2Z1bFdoZW5CbGFuayAobm9kZSkgewogICAgcmV0dXJuIGlzKG5vZGUsIG1lYW5pbmdmdWxXaGVuQmxhbmtFbGVtZW50cykKICB9CgogIGZ1bmN0aW9uIGhhc01lYW5pbmdmdWxXaGVuQmxhbmsgKG5vZGUpIHsKICAgIHJldHVybiBoYXMobm9kZSwgbWVhbmluZ2Z1bFdoZW5CbGFua0VsZW1lbnRzKQogIH0KCiAgZnVuY3Rpb24gaXMgKG5vZGUsIHRhZ05hbWVzKSB7CiAgICByZXR1cm4gdGFnTmFtZXMuaW5kZXhPZihub2RlLm5vZGVOYW1lKSA+PSAwCiAgfQoKICBmdW5jdGlvbiBoYXMgKG5vZGUsIHRhZ05hbWVzKSB7CiAgICByZXR1cm4gKAogICAgICBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lICYmCiAgICAgIHRhZ05hbWVzLnNvbWUoZnVuY3Rpb24gKHRhZ05hbWUpIHsKICAgICAgICByZXR1cm4gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lKS5sZW5ndGgKICAgICAgfSkKICAgICkKICB9CgogIHZhciBydWxlcyA9IHt9OwoKICBydWxlcy5wYXJhZ3JhcGggPSB7CiAgICBmaWx0ZXI6ICdwJywKCiAgICByZXBsYWNlbWVudDogZnVuY3Rpb24gKGNvbnRlbnQpIHsKICAgICAgcmV0dXJuICdcblxuJyArIGNvbnRlbnQgKyAnXG5cbicKICAgIH0KICB9OwoKICBydWxlcy5saW5lQnJlYWsgPSB7CiAgICBmaWx0ZXI6ICdicicsCgogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiBvcHRpb25zLmJyICsgJ1xuJwogICAgfQogIH07CgogIHJ1bGVzLmhlYWRpbmcgPSB7CiAgICBmaWx0ZXI6IFsnaDEnLCAnaDInLCAnaDMnLCAnaDQnLCAnaDUnLCAnaDYnXSwKCiAgICByZXBsYWNlbWVudDogZnVuY3Rpb24gKGNvbnRlbnQsIG5vZGUsIG9wdGlvbnMpIHsKICAgICAgdmFyIGhMZXZlbCA9IE51bWJlcihub2RlLm5vZGVOYW1lLmNoYXJBdCgxKSk7CgogICAgICBpZiAob3B0aW9ucy5oZWFkaW5nU3R5bGUgPT09ICdzZXRleHQnICYmIGhMZXZlbCA8IDMpIHsKICAgICAgICB2YXIgdW5kZXJsaW5lID0gcmVwZWF0KChoTGV2ZWwgPT09IDEgPyAnPScgOiAnLScpLCBjb250ZW50Lmxlbmd0aCk7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICdcblxuJyArIGNvbnRlbnQgKyAnXG4nICsgdW5kZXJsaW5lICsgJ1xuXG4nCiAgICAgICAgKQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAnXG5cbicgKyByZXBlYXQoJyMnLCBoTGV2ZWwpICsgJyAnICsgY29udGVudCArICdcblxuJwogICAgICB9CiAgICB9CiAgfTsKCiAgcnVsZXMuYmxvY2txdW90ZSA9IHsKICAgIGZpbHRlcjogJ2Jsb2NrcXVvdGUnLAoKICAgIHJlcGxhY2VtZW50OiBmdW5jdGlvbiAoY29udGVudCkgewogICAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKC9eXG4rfFxuKyQvZywgJycpOwogICAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKC9eL2dtLCAnPiAnKTsKICAgICAgcmV0dXJuICdcblxuJyArIGNvbnRlbnQgKyAnXG5cbicKICAgIH0KICB9OwoKICBydWxlcy5saXN0ID0gewogICAgZmlsdGVyOiBbJ3VsJywgJ29sJ10sCgogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlKSB7CiAgICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudE5vZGU7CiAgICAgIGlmIChwYXJlbnQubm9kZU5hbWUgPT09ICdMSScgJiYgcGFyZW50Lmxhc3RFbGVtZW50Q2hpbGQgPT09IG5vZGUpIHsKICAgICAgICByZXR1cm4gJ1xuJyArIGNvbnRlbnQKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJ1xuXG4nICsgY29udGVudCArICdcblxuJwogICAgICB9CiAgICB9CiAgfTsKCiAgcnVsZXMubGlzdEl0ZW0gPSB7CiAgICBmaWx0ZXI6ICdsaScsCgogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlLCBvcHRpb25zKSB7CiAgICAgIGNvbnRlbnQgPSBjb250ZW50CiAgICAgICAgLnJlcGxhY2UoL15cbisvLCAnJykgLy8gcmVtb3ZlIGxlYWRpbmcgbmV3bGluZXMKICAgICAgICAucmVwbGFjZSgvXG4rJC8sICdcbicpIC8vIHJlcGxhY2UgdHJhaWxpbmcgbmV3bGluZXMgd2l0aCBqdXN0IGEgc2luZ2xlIG9uZQogICAgICAgIC5yZXBsYWNlKC9cbi9nbSwgJ1xuICAgICcpOyAvLyBpbmRlbnQKICAgICAgdmFyIHByZWZpeCA9IG9wdGlvbnMuYnVsbGV0TGlzdE1hcmtlciArICcgICAnOwogICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlOwogICAgICBpZiAocGFyZW50Lm5vZGVOYW1lID09PSAnT0wnKSB7CiAgICAgICAgdmFyIHN0YXJ0ID0gcGFyZW50LmdldEF0dHJpYnV0ZSgnc3RhcnQnKTsKICAgICAgICB2YXIgaW5kZXggPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKHBhcmVudC5jaGlsZHJlbiwgbm9kZSk7CiAgICAgICAgcHJlZml4ID0gKHN0YXJ0ID8gTnVtYmVyKHN0YXJ0KSArIGluZGV4IDogaW5kZXggKyAxKSArICcuICAnOwogICAgICB9CiAgICAgIHJldHVybiAoCiAgICAgICAgcHJlZml4ICsgY29udGVudCArIChub2RlLm5leHRTaWJsaW5nICYmICEvXG4kLy50ZXN0KGNvbnRlbnQpID8gJ1xuJyA6ICcnKQogICAgICApCiAgICB9CiAgfTsKCiAgcnVsZXMuaW5kZW50ZWRDb2RlQmxvY2sgPSB7CiAgICBmaWx0ZXI6IGZ1bmN0aW9uIChub2RlLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgb3B0aW9ucy5jb2RlQmxvY2tTdHlsZSA9PT0gJ2luZGVudGVkJyAmJgogICAgICAgIG5vZGUubm9kZU5hbWUgPT09ICdQUkUnICYmCiAgICAgICAgbm9kZS5maXJzdENoaWxkICYmCiAgICAgICAgbm9kZS5maXJzdENoaWxkLm5vZGVOYW1lID09PSAnQ09ERScKICAgICAgKQogICAgfSwKCiAgICByZXBsYWNlbWVudDogZnVuY3Rpb24gKGNvbnRlbnQsIG5vZGUsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuICgKICAgICAgICAnXG5cbiAgICAnICsKICAgICAgICBub2RlLmZpcnN0Q2hpbGQudGV4dENvbnRlbnQucmVwbGFjZSgvXG4vZywgJ1xuICAgICcpICsKICAgICAgICAnXG5cbicKICAgICAgKQogICAgfQogIH07CgogIHJ1bGVzLmZlbmNlZENvZGVCbG9jayA9IHsKICAgIGZpbHRlcjogZnVuY3Rpb24gKG5vZGUsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuICgKICAgICAgICBvcHRpb25zLmNvZGVCbG9ja1N0eWxlID09PSAnZmVuY2VkJyAmJgogICAgICAgIG5vZGUubm9kZU5hbWUgPT09ICdQUkUnICYmCiAgICAgICAgbm9kZS5maXJzdENoaWxkICYmCiAgICAgICAgbm9kZS5maXJzdENoaWxkLm5vZGVOYW1lID09PSAnQ09ERScKICAgICAgKQogICAgfSwKCiAgICByZXBsYWNlbWVudDogZnVuY3Rpb24gKGNvbnRlbnQsIG5vZGUsIG9wdGlvbnMpIHsKICAgICAgdmFyIGNsYXNzTmFtZSA9IG5vZGUuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykgfHwgJyc7CiAgICAgIHZhciBsYW5ndWFnZSA9IChjbGFzc05hbWUubWF0Y2goL2xhbmd1YWdlLShcUyspLykgfHwgW251bGwsICcnXSlbMV07CiAgICAgIHZhciBjb2RlID0gbm9kZS5maXJzdENoaWxkLnRleHRDb250ZW50OwoKICAgICAgdmFyIGZlbmNlQ2hhciA9IG9wdGlvbnMuZmVuY2UuY2hhckF0KDApOwogICAgICB2YXIgZmVuY2VTaXplID0gMzsKICAgICAgdmFyIGZlbmNlSW5Db2RlUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIGZlbmNlQ2hhciArICd7Myx9JywgJ2dtJyk7CgogICAgICB2YXIgbWF0Y2g7CiAgICAgIHdoaWxlICgobWF0Y2ggPSBmZW5jZUluQ29kZVJlZ2V4LmV4ZWMoY29kZSkpKSB7CiAgICAgICAgaWYgKG1hdGNoWzBdLmxlbmd0aCA+PSBmZW5jZVNpemUpIHsKICAgICAgICAgIGZlbmNlU2l6ZSA9IG1hdGNoWzBdLmxlbmd0aCArIDE7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgZmVuY2UgPSByZXBlYXQoZmVuY2VDaGFyLCBmZW5jZVNpemUpOwoKICAgICAgcmV0dXJuICgKICAgICAgICAnXG5cbicgKyBmZW5jZSArIGxhbmd1YWdlICsgJ1xuJyArCiAgICAgICAgY29kZS5yZXBsYWNlKC9cbiQvLCAnJykgKwogICAgICAgICdcbicgKyBmZW5jZSArICdcblxuJwogICAgICApCiAgICB9CiAgfTsKCiAgcnVsZXMuaG9yaXpvbnRhbFJ1bGUgPSB7CiAgICBmaWx0ZXI6ICdocicsCgogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiAnXG5cbicgKyBvcHRpb25zLmhyICsgJ1xuXG4nCiAgICB9CiAgfTsKCiAgcnVsZXMuaW5saW5lTGluayA9IHsKICAgIGZpbHRlcjogZnVuY3Rpb24gKG5vZGUsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuICgKICAgICAgICBvcHRpb25zLmxpbmtTdHlsZSA9PT0gJ2lubGluZWQnICYmCiAgICAgICAgbm9kZS5ub2RlTmFtZSA9PT0gJ0EnICYmCiAgICAgICAgbm9kZS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKQogICAgICApCiAgICB9LAoKICAgIHJlcGxhY2VtZW50OiBmdW5jdGlvbiAoY29udGVudCwgbm9kZSkgewogICAgICB2YXIgaHJlZiA9IG5vZGUuZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgIGlmIChocmVmKSBocmVmID0gaHJlZi5yZXBsYWNlKC8oWygpXSkvZywgJ1xcJDEnKTsKICAgICAgdmFyIHRpdGxlID0gY2xlYW5BdHRyaWJ1dGUobm9kZS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykpOwogICAgICBpZiAodGl0bGUpIHRpdGxlID0gJyAiJyArIHRpdGxlLnJlcGxhY2UoLyIvZywgJ1xcIicpICsgJyInOwogICAgICByZXR1cm4gJ1snICsgY29udGVudCArICddKCcgKyBocmVmICsgdGl0bGUgKyAnKScKICAgIH0KICB9OwoKICBydWxlcy5yZWZlcmVuY2VMaW5rID0gewogICAgZmlsdGVyOiBmdW5jdGlvbiAobm9kZSwgb3B0aW9ucykgewogICAgICByZXR1cm4gKAogICAgICAgIG9wdGlvbnMubGlua1N0eWxlID09PSAncmVmZXJlbmNlZCcgJiYKICAgICAgICBub2RlLm5vZGVOYW1lID09PSAnQScgJiYKICAgICAgICBub2RlLmdldEF0dHJpYnV0ZSgnaHJlZicpCiAgICAgICkKICAgIH0sCgogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlLCBvcHRpb25zKSB7CiAgICAgIHZhciBocmVmID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTsKICAgICAgdmFyIHRpdGxlID0gY2xlYW5BdHRyaWJ1dGUobm9kZS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykpOwogICAgICBpZiAodGl0bGUpIHRpdGxlID0gJyAiJyArIHRpdGxlICsgJyInOwogICAgICB2YXIgcmVwbGFjZW1lbnQ7CiAgICAgIHZhciByZWZlcmVuY2U7CgogICAgICBzd2l0Y2ggKG9wdGlvbnMubGlua1JlZmVyZW5jZVN0eWxlKSB7CiAgICAgICAgY2FzZSAnY29sbGFwc2VkJzoKICAgICAgICAgIHJlcGxhY2VtZW50ID0gJ1snICsgY29udGVudCArICddW10nOwogICAgICAgICAgcmVmZXJlbmNlID0gJ1snICsgY29udGVudCArICddOiAnICsgaHJlZiArIHRpdGxlOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdzaG9ydGN1dCc6CiAgICAgICAgICByZXBsYWNlbWVudCA9ICdbJyArIGNvbnRlbnQgKyAnXSc7CiAgICAgICAgICByZWZlcmVuY2UgPSAnWycgKyBjb250ZW50ICsgJ106ICcgKyBocmVmICsgdGl0bGU7CiAgICAgICAgICBicmVhawogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB2YXIgaWQgPSB0aGlzLnJlZmVyZW5jZXMubGVuZ3RoICsgMTsKICAgICAgICAgIHJlcGxhY2VtZW50ID0gJ1snICsgY29udGVudCArICddWycgKyBpZCArICddJzsKICAgICAgICAgIHJlZmVyZW5jZSA9ICdbJyArIGlkICsgJ106ICcgKyBocmVmICsgdGl0bGU7CiAgICAgIH0KCiAgICAgIHRoaXMucmVmZXJlbmNlcy5wdXNoKHJlZmVyZW5jZSk7CiAgICAgIHJldHVybiByZXBsYWNlbWVudAogICAgfSwKCiAgICByZWZlcmVuY2VzOiBbXSwKCiAgICBhcHBlbmQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIHZhciByZWZlcmVuY2VzID0gJyc7CiAgICAgIGlmICh0aGlzLnJlZmVyZW5jZXMubGVuZ3RoKSB7CiAgICAgICAgcmVmZXJlbmNlcyA9ICdcblxuJyArIHRoaXMucmVmZXJlbmNlcy5qb2luKCdcbicpICsgJ1xuXG4nOwogICAgICAgIHRoaXMucmVmZXJlbmNlcyA9IFtdOyAvLyBSZXNldCByZWZlcmVuY2VzCiAgICAgIH0KICAgICAgcmV0dXJuIHJlZmVyZW5jZXMKICAgIH0KICB9OwoKICBydWxlcy5lbXBoYXNpcyA9IHsKICAgIGZpbHRlcjogWydlbScsICdpJ10sCgogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlLCBvcHRpb25zKSB7CiAgICAgIGlmICghY29udGVudC50cmltKCkpIHJldHVybiAnJwogICAgICByZXR1cm4gb3B0aW9ucy5lbURlbGltaXRlciArIGNvbnRlbnQgKyBvcHRpb25zLmVtRGVsaW1pdGVyCiAgICB9CiAgfTsKCiAgcnVsZXMuc3Ryb25nID0gewogICAgZmlsdGVyOiBbJ3N0cm9uZycsICdiJ10sCgogICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlLCBvcHRpb25zKSB7CiAgICAgIGlmICghY29udGVudC50cmltKCkpIHJldHVybiAnJwogICAgICByZXR1cm4gb3B0aW9ucy5zdHJvbmdEZWxpbWl0ZXIgKyBjb250ZW50ICsgb3B0aW9ucy5zdHJvbmdEZWxpbWl0ZXIKICAgIH0KICB9OwoKICBydWxlcy5jb2RlID0gewogICAgZmlsdGVyOiBmdW5jdGlvbiAobm9kZSkgewogICAgICB2YXIgaGFzU2libGluZ3MgPSBub2RlLnByZXZpb3VzU2libGluZyB8fCBub2RlLm5leHRTaWJsaW5nOwogICAgICB2YXIgaXNDb2RlQmxvY2sgPSBub2RlLnBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdQUkUnICYmICFoYXNTaWJsaW5nczsKCiAgICAgIHJldHVybiBub2RlLm5vZGVOYW1lID09PSAnQ09ERScgJiYgIWlzQ29kZUJsb2NrCiAgICB9LAoKICAgIHJlcGxhY2VtZW50OiBmdW5jdGlvbiAoY29udGVudCkgewogICAgICBpZiAoIWNvbnRlbnQpIHJldHVybiAnJwogICAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKC9ccj9cbnxcci9nLCAnICcpOwoKICAgICAgdmFyIGV4dHJhU3BhY2UgPSAvXmB8XiAuKj9bXiBdLiogJHxgJC8udGVzdChjb250ZW50KSA/ICcgJyA6ICcnOwogICAgICB2YXIgZGVsaW1pdGVyID0gJ2AnOwogICAgICB2YXIgbWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2goL2ArL2dtKSB8fCBbXTsKICAgICAgd2hpbGUgKG1hdGNoZXMuaW5kZXhPZihkZWxpbWl0ZXIpICE9PSAtMSkgZGVsaW1pdGVyID0gZGVsaW1pdGVyICsgJ2AnOwoKICAgICAgcmV0dXJuIGRlbGltaXRlciArIGV4dHJhU3BhY2UgKyBjb250ZW50ICsgZXh0cmFTcGFjZSArIGRlbGltaXRlcgogICAgfQogIH07CgogIHJ1bGVzLmltYWdlID0gewogICAgZmlsdGVyOiAnaW1nJywKCiAgICByZXBsYWNlbWVudDogZnVuY3Rpb24gKGNvbnRlbnQsIG5vZGUpIHsKICAgICAgdmFyIGFsdCA9IGNsZWFuQXR0cmlidXRlKG5vZGUuZ2V0QXR0cmlidXRlKCdhbHQnKSk7CiAgICAgIHZhciBzcmMgPSBub2RlLmdldEF0dHJpYnV0ZSgnc3JjJykgfHwgJyc7CiAgICAgIHZhciB0aXRsZSA9IGNsZWFuQXR0cmlidXRlKG5vZGUuZ2V0QXR0cmlidXRlKCd0aXRsZScpKTsKICAgICAgdmFyIHRpdGxlUGFydCA9IHRpdGxlID8gJyAiJyArIHRpdGxlICsgJyInIDogJyc7CiAgICAgIHJldHVybiBzcmMgPyAnIVsnICsgYWx0ICsgJ10nICsgJygnICsgc3JjICsgdGl0bGVQYXJ0ICsgJyknIDogJycKICAgIH0KICB9OwoKICBmdW5jdGlvbiBjbGVhbkF0dHJpYnV0ZSAoYXR0cmlidXRlKSB7CiAgICByZXR1cm4gYXR0cmlidXRlID8gYXR0cmlidXRlLnJlcGxhY2UoLyhcbitccyopKy9nLCAnXG4nKSA6ICcnCiAgfQoKICAvKioKICAgKiBNYW5hZ2VzIGEgY29sbGVjdGlvbiBvZiBydWxlcyB1c2VkIHRvIGNvbnZlcnQgSFRNTCB0byBNYXJrZG93bgogICAqLwoKICBmdW5jdGlvbiBSdWxlcyAob3B0aW9ucykgewogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIHRoaXMuX2tlZXAgPSBbXTsKICAgIHRoaXMuX3JlbW92ZSA9IFtdOwoKICAgIHRoaXMuYmxhbmtSdWxlID0gewogICAgICByZXBsYWNlbWVudDogb3B0aW9ucy5ibGFua1JlcGxhY2VtZW50CiAgICB9OwoKICAgIHRoaXMua2VlcFJlcGxhY2VtZW50ID0gb3B0aW9ucy5rZWVwUmVwbGFjZW1lbnQ7CgogICAgdGhpcy5kZWZhdWx0UnVsZSA9IHsKICAgICAgcmVwbGFjZW1lbnQ6IG9wdGlvbnMuZGVmYXVsdFJlcGxhY2VtZW50CiAgICB9OwoKICAgIHRoaXMuYXJyYXkgPSBbXTsKICAgIGZvciAodmFyIGtleSBpbiBvcHRpb25zLnJ1bGVzKSB0aGlzLmFycmF5LnB1c2gob3B0aW9ucy5ydWxlc1trZXldKTsKICB9CgogIFJ1bGVzLnByb3RvdHlwZSA9IHsKICAgIGFkZDogZnVuY3Rpb24gKGtleSwgcnVsZSkgewogICAgICB0aGlzLmFycmF5LnVuc2hpZnQocnVsZSk7CiAgICB9LAoKICAgIGtlZXA6IGZ1bmN0aW9uIChmaWx0ZXIpIHsKICAgICAgdGhpcy5fa2VlcC51bnNoaWZ0KHsKICAgICAgICBmaWx0ZXI6IGZpbHRlciwKICAgICAgICByZXBsYWNlbWVudDogdGhpcy5rZWVwUmVwbGFjZW1lbnQKICAgICAgfSk7CiAgICB9LAoKICAgIHJlbW92ZTogZnVuY3Rpb24gKGZpbHRlcikgewogICAgICB0aGlzLl9yZW1vdmUudW5zaGlmdCh7CiAgICAgICAgZmlsdGVyOiBmaWx0ZXIsCiAgICAgICAgcmVwbGFjZW1lbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAnJwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGZvck5vZGU6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgIGlmIChub2RlLmlzQmxhbmspIHJldHVybiB0aGlzLmJsYW5rUnVsZQogICAgICB2YXIgcnVsZTsKCiAgICAgIGlmICgocnVsZSA9IGZpbmRSdWxlKHRoaXMuYXJyYXksIG5vZGUsIHRoaXMub3B0aW9ucykpKSByZXR1cm4gcnVsZQogICAgICBpZiAoKHJ1bGUgPSBmaW5kUnVsZSh0aGlzLl9rZWVwLCBub2RlLCB0aGlzLm9wdGlvbnMpKSkgcmV0dXJuIHJ1bGUKICAgICAgaWYgKChydWxlID0gZmluZFJ1bGUodGhpcy5fcmVtb3ZlLCBub2RlLCB0aGlzLm9wdGlvbnMpKSkgcmV0dXJuIHJ1bGUKCiAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRSdWxlCiAgICB9LAoKICAgIGZvckVhY2g6IGZ1bmN0aW9uIChmbikgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYXJyYXkubGVuZ3RoOyBpKyspIGZuKHRoaXMuYXJyYXlbaV0sIGkpOwogICAgfQogIH07CgogIGZ1bmN0aW9uIGZpbmRSdWxlIChydWxlcywgbm9kZSwgb3B0aW9ucykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBydWxlcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgcnVsZSA9IHJ1bGVzW2ldOwogICAgICBpZiAoZmlsdGVyVmFsdWUocnVsZSwgbm9kZSwgb3B0aW9ucykpIHJldHVybiBydWxlCiAgICB9CiAgICByZXR1cm4gdm9pZCAwCiAgfQoKICBmdW5jdGlvbiBmaWx0ZXJWYWx1ZSAocnVsZSwgbm9kZSwgb3B0aW9ucykgewogICAgdmFyIGZpbHRlciA9IHJ1bGUuZmlsdGVyOwogICAgaWYgKHR5cGVvZiBmaWx0ZXIgPT09ICdzdHJpbmcnKSB7CiAgICAgIGlmIChmaWx0ZXIgPT09IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgcmV0dXJuIHRydWUKICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShmaWx0ZXIpKSB7CiAgICAgIGlmIChmaWx0ZXIuaW5kZXhPZihub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpID4gLTEpIHJldHVybiB0cnVlCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBmaWx0ZXIgPT09ICdmdW5jdGlvbicpIHsKICAgICAgaWYgKGZpbHRlci5jYWxsKHJ1bGUsIG5vZGUsIG9wdGlvbnMpKSByZXR1cm4gdHJ1ZQogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignYGZpbHRlcmAgbmVlZHMgdG8gYmUgYSBzdHJpbmcsIGFycmF5LCBvciBmdW5jdGlvbicpCiAgICB9CiAgfQoKICAvKioKICAgKiBUaGUgY29sbGFwc2VXaGl0ZXNwYWNlIGZ1bmN0aW9uIGlzIGFkYXB0ZWQgZnJvbSBjb2xsYXBzZS13aGl0ZXNwYWNlCiAgICogYnkgTHVjIFRoZXZlbmFyZC4KICAgKgogICAqIFRoZSBNSVQgTGljZW5zZSAoTUlUKQogICAqCiAgICogQ29weXJpZ2h0IChjKSAyMDE0IEx1YyBUaGV2ZW5hcmQgPGx1Y3RoZXZlbmFyZEBnbWFpbC5jb20+CiAgICoKICAgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiAgICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKICAgKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAgICogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogICAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwogICAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CiAgICoKICAgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgogICAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgogICAqCiAgICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKICAgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKICAgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKICAgKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiAgICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKICAgKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiAgICogVEhFIFNPRlRXQVJFLgogICAqLwoKICAvKioKICAgKiBjb2xsYXBzZVdoaXRlc3BhY2Uob3B0aW9ucykgcmVtb3ZlcyBleHRyYW5lb3VzIHdoaXRlc3BhY2UgZnJvbSBhbiB0aGUgZ2l2ZW4gZWxlbWVudC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICovCiAgZnVuY3Rpb24gY29sbGFwc2VXaGl0ZXNwYWNlIChvcHRpb25zKSB7CiAgICB2YXIgZWxlbWVudCA9IG9wdGlvbnMuZWxlbWVudDsKICAgIHZhciBpc0Jsb2NrID0gb3B0aW9ucy5pc0Jsb2NrOwogICAgdmFyIGlzVm9pZCA9IG9wdGlvbnMuaXNWb2lkOwogICAgdmFyIGlzUHJlID0gb3B0aW9ucy5pc1ByZSB8fCBmdW5jdGlvbiAobm9kZSkgewogICAgICByZXR1cm4gbm9kZS5ub2RlTmFtZSA9PT0gJ1BSRScKICAgIH07CgogICAgaWYgKCFlbGVtZW50LmZpcnN0Q2hpbGQgfHwgaXNQcmUoZWxlbWVudCkpIHJldHVybgoKICAgIHZhciBwcmV2VGV4dCA9IG51bGw7CiAgICB2YXIga2VlcExlYWRpbmdXcyA9IGZhbHNlOwoKICAgIHZhciBwcmV2ID0gbnVsbDsKICAgIHZhciBub2RlID0gbmV4dChwcmV2LCBlbGVtZW50LCBpc1ByZSk7CgogICAgd2hpbGUgKG5vZGUgIT09IGVsZW1lbnQpIHsKICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDMgfHwgbm9kZS5ub2RlVHlwZSA9PT0gNCkgeyAvLyBOb2RlLlRFWFRfTk9ERSBvciBOb2RlLkNEQVRBX1NFQ1RJT05fTk9ERQogICAgICAgIHZhciB0ZXh0ID0gbm9kZS5kYXRhLnJlcGxhY2UoL1sgXHJcblx0XSsvZywgJyAnKTsKCiAgICAgICAgaWYgKCghcHJldlRleHQgfHwgLyAkLy50ZXN0KHByZXZUZXh0LmRhdGEpKSAmJgogICAgICAgICAgICAha2VlcExlYWRpbmdXcyAmJiB0ZXh0WzBdID09PSAnICcpIHsKICAgICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cigxKTsKICAgICAgICB9CgogICAgICAgIC8vIGB0ZXh0YCBtaWdodCBiZSBlbXB0eSBhdCB0aGlzIHBvaW50LgogICAgICAgIGlmICghdGV4dCkgewogICAgICAgICAgbm9kZSA9IHJlbW92ZShub2RlKTsKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgfQoKICAgICAgICBub2RlLmRhdGEgPSB0ZXh0OwoKICAgICAgICBwcmV2VGV4dCA9IG5vZGU7CiAgICAgIH0gZWxzZSBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkgeyAvLyBOb2RlLkVMRU1FTlRfTk9ERQogICAgICAgIGlmIChpc0Jsb2NrKG5vZGUpIHx8IG5vZGUubm9kZU5hbWUgPT09ICdCUicpIHsKICAgICAgICAgIGlmIChwcmV2VGV4dCkgewogICAgICAgICAgICBwcmV2VGV4dC5kYXRhID0gcHJldlRleHQuZGF0YS5yZXBsYWNlKC8gJC8sICcnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBwcmV2VGV4dCA9IG51bGw7CiAgICAgICAgICBrZWVwTGVhZGluZ1dzID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmIChpc1ZvaWQobm9kZSkgfHwgaXNQcmUobm9kZSkpIHsKICAgICAgICAgIC8vIEF2b2lkIHRyaW1taW5nIHNwYWNlIGFyb3VuZCBub24tYmxvY2ssIG5vbi1CUiB2b2lkIGVsZW1lbnRzIGFuZCBpbmxpbmUgUFJFLgogICAgICAgICAgcHJldlRleHQgPSBudWxsOwogICAgICAgICAga2VlcExlYWRpbmdXcyA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChwcmV2VGV4dCkgewogICAgICAgICAgLy8gRHJvcCBwcm90ZWN0aW9uIGlmIHNldCBwcmV2aW91c2x5LgogICAgICAgICAga2VlcExlYWRpbmdXcyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBub2RlID0gcmVtb3ZlKG5vZGUpOwogICAgICAgIGNvbnRpbnVlCiAgICAgIH0KCiAgICAgIHZhciBuZXh0Tm9kZSA9IG5leHQocHJldiwgbm9kZSwgaXNQcmUpOwogICAgICBwcmV2ID0gbm9kZTsKICAgICAgbm9kZSA9IG5leHROb2RlOwogICAgfQoKICAgIGlmIChwcmV2VGV4dCkgewogICAgICBwcmV2VGV4dC5kYXRhID0gcHJldlRleHQuZGF0YS5yZXBsYWNlKC8gJC8sICcnKTsKICAgICAgaWYgKCFwcmV2VGV4dC5kYXRhKSB7CiAgICAgICAgcmVtb3ZlKHByZXZUZXh0KTsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogcmVtb3ZlKG5vZGUpIHJlbW92ZXMgdGhlIGdpdmVuIG5vZGUgZnJvbSB0aGUgRE9NIGFuZCByZXR1cm5zIHRoZQogICAqIG5leHQgbm9kZSBpbiB0aGUgc2VxdWVuY2UuCiAgICoKICAgKiBAcGFyYW0ge05vZGV9IG5vZGUKICAgKiBAcmV0dXJuIHtOb2RlfSBub2RlCiAgICovCiAgZnVuY3Rpb24gcmVtb3ZlIChub2RlKSB7CiAgICB2YXIgbmV4dCA9IG5vZGUubmV4dFNpYmxpbmcgfHwgbm9kZS5wYXJlbnROb2RlOwoKICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTsKCiAgICByZXR1cm4gbmV4dAogIH0KCiAgLyoqCiAgICogbmV4dChwcmV2LCBjdXJyZW50LCBpc1ByZSkgcmV0dXJucyB0aGUgbmV4dCBub2RlIGluIHRoZSBzZXF1ZW5jZSwgZ2l2ZW4gdGhlCiAgICogY3VycmVudCBhbmQgcHJldmlvdXMgbm9kZXMuCiAgICoKICAgKiBAcGFyYW0ge05vZGV9IHByZXYKICAgKiBAcGFyYW0ge05vZGV9IGN1cnJlbnQKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpc1ByZQogICAqIEByZXR1cm4ge05vZGV9CiAgICovCiAgZnVuY3Rpb24gbmV4dCAocHJldiwgY3VycmVudCwgaXNQcmUpIHsKICAgIGlmICgocHJldiAmJiBwcmV2LnBhcmVudE5vZGUgPT09IGN1cnJlbnQpIHx8IGlzUHJlKGN1cnJlbnQpKSB7CiAgICAgIHJldHVybiBjdXJyZW50Lm5leHRTaWJsaW5nIHx8IGN1cnJlbnQucGFyZW50Tm9kZQogICAgfQoKICAgIHJldHVybiBjdXJyZW50LmZpcnN0Q2hpbGQgfHwgY3VycmVudC5uZXh0U2libGluZyB8fCBjdXJyZW50LnBhcmVudE5vZGUKICB9CgogIC8qCiAgICogU2V0IHVwIHdpbmRvdyBmb3IgTm9kZS5qcwogICAqLwoKICB2YXIgcm9vdCA9ICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHt9KTsKCiAgLyoKICAgKiBQYXJzaW5nIEhUTUwgc3RyaW5ncwogICAqLwoKICBmdW5jdGlvbiBjYW5QYXJzZUhUTUxOYXRpdmVseSAoKSB7CiAgICB2YXIgUGFyc2VyID0gcm9vdC5ET01QYXJzZXI7CiAgICB2YXIgY2FuUGFyc2UgPSBmYWxzZTsKCiAgICAvLyBBZGFwdGVkIGZyb20gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vMTEyOTAzMQogICAgLy8gRmlyZWZveC9PcGVyYS9JRSB0aHJvdyBlcnJvcnMgb24gdW5zdXBwb3J0ZWQgdHlwZXMKICAgIHRyeSB7CiAgICAgIC8vIFdlYktpdCByZXR1cm5zIG51bGwgb24gdW5zdXBwb3J0ZWQgdHlwZXMKICAgICAgaWYgKG5ldyBQYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoJycsICd0ZXh0L2h0bWwnKSkgewogICAgICAgIGNhblBhcnNlID0gdHJ1ZTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkge30KCiAgICByZXR1cm4gY2FuUGFyc2UKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUhUTUxQYXJzZXIgKCkgewogICAgdmFyIFBhcnNlciA9IGZ1bmN0aW9uICgpIHt9OwoKICAgIHsKICAgICAgaWYgKHNob3VsZFVzZUFjdGl2ZVgoKSkgewogICAgICAgIFBhcnNlci5wcm90b3R5cGUucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZykgewogICAgICAgICAgdmFyIGRvYyA9IG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdCgnaHRtbGZpbGUnKTsKICAgICAgICAgIGRvYy5kZXNpZ25Nb2RlID0gJ29uJzsgLy8gZGlzYWJsZSBvbi1wYWdlIHNjcmlwdHMKICAgICAgICAgIGRvYy5vcGVuKCk7CiAgICAgICAgICBkb2Mud3JpdGUoc3RyaW5nKTsKICAgICAgICAgIGRvYy5jbG9zZSgpOwogICAgICAgICAgcmV0dXJuIGRvYwogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmcgPSBmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgICAgICB2YXIgZG9jID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCcnKTsKICAgICAgICAgIGRvYy5vcGVuKCk7CiAgICAgICAgICBkb2Mud3JpdGUoc3RyaW5nKTsKICAgICAgICAgIGRvYy5jbG9zZSgpOwogICAgICAgICAgcmV0dXJuIGRvYwogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBQYXJzZXIKICB9CgogIGZ1bmN0aW9uIHNob3VsZFVzZUFjdGl2ZVggKCkgewogICAgdmFyIHVzZUFjdGl2ZVggPSBmYWxzZTsKICAgIHRyeSB7CiAgICAgIGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudCgnJykub3BlbigpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAocm9vdC5BY3RpdmVYT2JqZWN0KSB1c2VBY3RpdmVYID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB1c2VBY3RpdmVYCiAgfQoKICB2YXIgSFRNTFBhcnNlciA9IGNhblBhcnNlSFRNTE5hdGl2ZWx5KCkgPyByb290LkRPTVBhcnNlciA6IGNyZWF0ZUhUTUxQYXJzZXIoKTsKCiAgZnVuY3Rpb24gUm9vdE5vZGUgKGlucHV0LCBvcHRpb25zKSB7CiAgICB2YXIgcm9vdDsKICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7CiAgICAgIHZhciBkb2MgPSBodG1sUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKAogICAgICAgIC8vIERPTSBwYXJzZXJzIGFycmFuZ2UgZWxlbWVudHMgaW4gdGhlIDxoZWFkPiBhbmQgPGJvZHk+LgogICAgICAgIC8vIFdyYXBwaW5nIGluIGEgY3VzdG9tIGVsZW1lbnQgZW5zdXJlcyBlbGVtZW50cyBhcmUgcmVsaWFibHkgYXJyYW5nZWQgaW4KICAgICAgICAvLyBhIHNpbmdsZSBlbGVtZW50LgogICAgICAgICc8eC10dXJuZG93biBpZD0idHVybmRvd24tcm9vdCI+JyArIGlucHV0ICsgJzwveC10dXJuZG93bj4nLAogICAgICAgICd0ZXh0L2h0bWwnCiAgICAgICk7CiAgICAgIHJvb3QgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoJ3R1cm5kb3duLXJvb3QnKTsKICAgIH0gZWxzZSB7CiAgICAgIHJvb3QgPSBpbnB1dC5jbG9uZU5vZGUodHJ1ZSk7CiAgICB9CiAgICBjb2xsYXBzZVdoaXRlc3BhY2UoewogICAgICBlbGVtZW50OiByb290LAogICAgICBpc0Jsb2NrOiBpc0Jsb2NrLAogICAgICBpc1ZvaWQ6IGlzVm9pZCwKICAgICAgaXNQcmU6IG9wdGlvbnMucHJlZm9ybWF0dGVkQ29kZSA/IGlzUHJlT3JDb2RlIDogbnVsbAogICAgfSk7CgogICAgcmV0dXJuIHJvb3QKICB9CgogIHZhciBfaHRtbFBhcnNlcjsKICBmdW5jdGlvbiBodG1sUGFyc2VyICgpIHsKICAgIF9odG1sUGFyc2VyID0gX2h0bWxQYXJzZXIgfHwgbmV3IEhUTUxQYXJzZXIoKTsKICAgIHJldHVybiBfaHRtbFBhcnNlcgogIH0KCiAgZnVuY3Rpb24gaXNQcmVPckNvZGUgKG5vZGUpIHsKICAgIHJldHVybiBub2RlLm5vZGVOYW1lID09PSAnUFJFJyB8fCBub2RlLm5vZGVOYW1lID09PSAnQ09ERScKICB9CgogIGZ1bmN0aW9uIE5vZGUgKG5vZGUsIG9wdGlvbnMpIHsKICAgIG5vZGUuaXNCbG9jayA9IGlzQmxvY2sobm9kZSk7CiAgICBub2RlLmlzQ29kZSA9IG5vZGUubm9kZU5hbWUgPT09ICdDT0RFJyB8fCBub2RlLnBhcmVudE5vZGUuaXNDb2RlOwogICAgbm9kZS5pc0JsYW5rID0gaXNCbGFuayhub2RlKTsKICAgIG5vZGUuZmxhbmtpbmdXaGl0ZXNwYWNlID0gZmxhbmtpbmdXaGl0ZXNwYWNlKG5vZGUsIG9wdGlvbnMpOwogICAgcmV0dXJuIG5vZGUKICB9CgogIGZ1bmN0aW9uIGlzQmxhbmsgKG5vZGUpIHsKICAgIHJldHVybiAoCiAgICAgICFpc1ZvaWQobm9kZSkgJiYKICAgICAgIWlzTWVhbmluZ2Z1bFdoZW5CbGFuayhub2RlKSAmJgogICAgICAvXlxzKiQvaS50ZXN0KG5vZGUudGV4dENvbnRlbnQpICYmCiAgICAgICFoYXNWb2lkKG5vZGUpICYmCiAgICAgICFoYXNNZWFuaW5nZnVsV2hlbkJsYW5rKG5vZGUpCiAgICApCiAgfQoKICBmdW5jdGlvbiBmbGFua2luZ1doaXRlc3BhY2UgKG5vZGUsIG9wdGlvbnMpIHsKICAgIGlmIChub2RlLmlzQmxvY2sgfHwgKG9wdGlvbnMucHJlZm9ybWF0dGVkQ29kZSAmJiBub2RlLmlzQ29kZSkpIHsKICAgICAgcmV0dXJuIHsgbGVhZGluZzogJycsIHRyYWlsaW5nOiAnJyB9CiAgICB9CgogICAgdmFyIGVkZ2VzID0gZWRnZVdoaXRlc3BhY2Uobm9kZS50ZXh0Q29udGVudCk7CgogICAgLy8gYWJhbmRvbiBsZWFkaW5nIEFTQ0lJIFdTIGlmIGxlZnQtZmxhbmtlZCBieSBBU0NJSSBXUwogICAgaWYgKGVkZ2VzLmxlYWRpbmdBc2NpaSAmJiBpc0ZsYW5rZWRCeVdoaXRlc3BhY2UoJ2xlZnQnLCBub2RlLCBvcHRpb25zKSkgewogICAgICBlZGdlcy5sZWFkaW5nID0gZWRnZXMubGVhZGluZ05vbkFzY2lpOwogICAgfQoKICAgIC8vIGFiYW5kb24gdHJhaWxpbmcgQVNDSUkgV1MgaWYgcmlnaHQtZmxhbmtlZCBieSBBU0NJSSBXUwogICAgaWYgKGVkZ2VzLnRyYWlsaW5nQXNjaWkgJiYgaXNGbGFua2VkQnlXaGl0ZXNwYWNlKCdyaWdodCcsIG5vZGUsIG9wdGlvbnMpKSB7CiAgICAgIGVkZ2VzLnRyYWlsaW5nID0gZWRnZXMudHJhaWxpbmdOb25Bc2NpaTsKICAgIH0KCiAgICByZXR1cm4geyBsZWFkaW5nOiBlZGdlcy5sZWFkaW5nLCB0cmFpbGluZzogZWRnZXMudHJhaWxpbmcgfQogIH0KCiAgZnVuY3Rpb24gZWRnZVdoaXRlc3BhY2UgKHN0cmluZykgewogICAgdmFyIG0gPSBzdHJpbmcubWF0Y2goL14oKFsgXHRcclxuXSopKFxzKikpKD86KD89XFMpW1xzXFNdKlxTKT8oKFxzKj8pKFsgXHRcclxuXSopKSQvKTsKICAgIHJldHVybiB7CiAgICAgIGxlYWRpbmc6IG1bMV0sIC8vIHdob2xlIHN0cmluZyBmb3Igd2hpdGVzcGFjZS1vbmx5IHN0cmluZ3MKICAgICAgbGVhZGluZ0FzY2lpOiBtWzJdLAogICAgICBsZWFkaW5nTm9uQXNjaWk6IG1bM10sCiAgICAgIHRyYWlsaW5nOiBtWzRdLCAvLyBlbXB0eSBmb3Igd2hpdGVzcGFjZS1vbmx5IHN0cmluZ3MKICAgICAgdHJhaWxpbmdOb25Bc2NpaTogbVs1XSwKICAgICAgdHJhaWxpbmdBc2NpaTogbVs2XQogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNGbGFua2VkQnlXaGl0ZXNwYWNlIChzaWRlLCBub2RlLCBvcHRpb25zKSB7CiAgICB2YXIgc2libGluZzsKICAgIHZhciByZWdFeHA7CiAgICB2YXIgaXNGbGFua2VkOwoKICAgIGlmIChzaWRlID09PSAnbGVmdCcpIHsKICAgICAgc2libGluZyA9IG5vZGUucHJldmlvdXNTaWJsaW5nOwogICAgICByZWdFeHAgPSAvICQvOwogICAgfSBlbHNlIHsKICAgICAgc2libGluZyA9IG5vZGUubmV4dFNpYmxpbmc7CiAgICAgIHJlZ0V4cCA9IC9eIC87CiAgICB9CgogICAgaWYgKHNpYmxpbmcpIHsKICAgICAgaWYgKHNpYmxpbmcubm9kZVR5cGUgPT09IDMpIHsKICAgICAgICBpc0ZsYW5rZWQgPSByZWdFeHAudGVzdChzaWJsaW5nLm5vZGVWYWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5wcmVmb3JtYXR0ZWRDb2RlICYmIHNpYmxpbmcubm9kZU5hbWUgPT09ICdDT0RFJykgewogICAgICAgIGlzRmxhbmtlZCA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHNpYmxpbmcubm9kZVR5cGUgPT09IDEgJiYgIWlzQmxvY2soc2libGluZykpIHsKICAgICAgICBpc0ZsYW5rZWQgPSByZWdFeHAudGVzdChzaWJsaW5nLnRleHRDb250ZW50KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGlzRmxhbmtlZAogIH0KCiAgdmFyIHJlZHVjZSA9IEFycmF5LnByb3RvdHlwZS5yZWR1Y2U7CiAgdmFyIGVzY2FwZXMgPSBbCiAgICBbL1xcL2csICdcXFxcJ10sCiAgICBbL1wqL2csICdcXConXSwKICAgIFsvXi0vZywgJ1xcLSddLAogICAgWy9eXCsgL2csICdcXCsgJ10sCiAgICBbL14oPSspL2csICdcXCQxJ10sCiAgICBbL14oI3sxLDZ9KSAvZywgJ1xcJDEgJ10sCiAgICBbL2AvZywgJ1xcYCddLAogICAgWy9efn5+L2csICdcXH5+fiddLAogICAgWy9cWy9nLCAnXFxbJ10sCiAgICBbL1xdL2csICdcXF0nXSwKICAgIFsvXj4vZywgJ1xcPiddLAogICAgWy9fL2csICdcXF8nXSwKICAgIFsvXihcZCspXC4gL2csICckMVxcLiAnXQogIF07CgogIGZ1bmN0aW9uIFR1cm5kb3duU2VydmljZSAob3B0aW9ucykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFR1cm5kb3duU2VydmljZSkpIHJldHVybiBuZXcgVHVybmRvd25TZXJ2aWNlKG9wdGlvbnMpCgogICAgdmFyIGRlZmF1bHRzID0gewogICAgICBydWxlczogcnVsZXMsCiAgICAgIGhlYWRpbmdTdHlsZTogJ3NldGV4dCcsCiAgICAgIGhyOiAnKiAqIConLAogICAgICBidWxsZXRMaXN0TWFya2VyOiAnKicsCiAgICAgIGNvZGVCbG9ja1N0eWxlOiAnaW5kZW50ZWQnLAogICAgICBmZW5jZTogJ2BgYCcsCiAgICAgIGVtRGVsaW1pdGVyOiAnXycsCiAgICAgIHN0cm9uZ0RlbGltaXRlcjogJyoqJywKICAgICAgbGlua1N0eWxlOiAnaW5saW5lZCcsCiAgICAgIGxpbmtSZWZlcmVuY2VTdHlsZTogJ2Z1bGwnLAogICAgICBicjogJyAgJywKICAgICAgcHJlZm9ybWF0dGVkQ29kZTogZmFsc2UsCiAgICAgIGJsYW5rUmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlKSB7CiAgICAgICAgcmV0dXJuIG5vZGUuaXNCbG9jayA/ICdcblxuJyA6ICcnCiAgICAgIH0sCiAgICAgIGtlZXBSZXBsYWNlbWVudDogZnVuY3Rpb24gKGNvbnRlbnQsIG5vZGUpIHsKICAgICAgICByZXR1cm4gbm9kZS5pc0Jsb2NrID8gJ1xuXG4nICsgbm9kZS5vdXRlckhUTUwgKyAnXG5cbicgOiBub2RlLm91dGVySFRNTAogICAgICB9LAogICAgICBkZWZhdWx0UmVwbGFjZW1lbnQ6IGZ1bmN0aW9uIChjb250ZW50LCBub2RlKSB7CiAgICAgICAgcmV0dXJuIG5vZGUuaXNCbG9jayA/ICdcblxuJyArIGNvbnRlbnQgKyAnXG5cbicgOiBjb250ZW50CiAgICAgIH0KICAgIH07CiAgICB0aGlzLm9wdGlvbnMgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKTsKICAgIHRoaXMucnVsZXMgPSBuZXcgUnVsZXModGhpcy5vcHRpb25zKTsKICB9CgogIFR1cm5kb3duU2VydmljZS5wcm90b3R5cGUgPSB7CiAgICAvKioKICAgICAqIFRoZSBlbnRyeSBwb2ludCBmb3IgY29udmVydGluZyBhIHN0cmluZyBvciBET00gbm9kZSB0byBNYXJrZG93bgogICAgICogQHB1YmxpYwogICAgICogQHBhcmFtIHtTdHJpbmd8SFRNTEVsZW1lbnR9IGlucHV0IFRoZSBzdHJpbmcgb3IgRE9NIG5vZGUgdG8gY29udmVydAogICAgICogQHJldHVybnMgQSBNYXJrZG93biByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5wdXQKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCgogICAgdHVybmRvd246IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICBpZiAoIWNhbkNvbnZlcnQoaW5wdXQpKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigKICAgICAgICAgIGlucHV0ICsgJyBpcyBub3QgYSBzdHJpbmcsIG9yIGFuIGVsZW1lbnQvZG9jdW1lbnQvZnJhZ21lbnQgbm9kZS4nCiAgICAgICAgKQogICAgICB9CgogICAgICBpZiAoaW5wdXQgPT09ICcnKSByZXR1cm4gJycKCiAgICAgIHZhciBvdXRwdXQgPSBwcm9jZXNzLmNhbGwodGhpcywgbmV3IFJvb3ROb2RlKGlucHV0LCB0aGlzLm9wdGlvbnMpKTsKICAgICAgcmV0dXJuIHBvc3RQcm9jZXNzLmNhbGwodGhpcywgb3V0cHV0KQogICAgfSwKCiAgICAvKioKICAgICAqIEFkZCBvbmUgb3IgbW9yZSBwbHVnaW5zCiAgICAgKiBAcHVibGljCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufEFycmF5fSBwbHVnaW4gVGhlIHBsdWdpbiBvciBhcnJheSBvZiBwbHVnaW5zIHRvIGFkZAogICAgICogQHJldHVybnMgVGhlIFR1cm5kb3duIGluc3RhbmNlIGZvciBjaGFpbmluZwogICAgICogQHR5cGUgT2JqZWN0CiAgICAgKi8KCiAgICB1c2U6IGZ1bmN0aW9uIChwbHVnaW4pIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGx1Z2luKSkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGx1Z2luLmxlbmd0aDsgaSsrKSB0aGlzLnVzZShwbHVnaW5baV0pOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwbHVnaW4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBwbHVnaW4odGhpcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigncGx1Z2luIG11c3QgYmUgYSBGdW5jdGlvbiBvciBhbiBBcnJheSBvZiBGdW5jdGlvbnMnKQogICAgICB9CiAgICAgIHJldHVybiB0aGlzCiAgICB9LAoKICAgIC8qKgogICAgICogQWRkcyBhIHJ1bGUKICAgICAqIEBwdWJsaWMKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBrZXkgVGhlIHVuaXF1ZSBrZXkgb2YgdGhlIHJ1bGUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBydWxlIFRoZSBydWxlCiAgICAgKiBAcmV0dXJucyBUaGUgVHVybmRvd24gaW5zdGFuY2UgZm9yIGNoYWluaW5nCiAgICAgKiBAdHlwZSBPYmplY3QKICAgICAqLwoKICAgIGFkZFJ1bGU6IGZ1bmN0aW9uIChrZXksIHJ1bGUpIHsKICAgICAgdGhpcy5ydWxlcy5hZGQoa2V5LCBydWxlKTsKICAgICAgcmV0dXJuIHRoaXMKICAgIH0sCgogICAgLyoqCiAgICAgKiBLZWVwIGEgbm9kZSAoYXMgSFRNTCkgdGhhdCBtYXRjaGVzIHRoZSBmaWx0ZXIKICAgICAqIEBwdWJsaWMKICAgICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5fEZ1bmN0aW9ufSBmaWx0ZXIgVGhlIHVuaXF1ZSBrZXkgb2YgdGhlIHJ1bGUKICAgICAqIEByZXR1cm5zIFRoZSBUdXJuZG93biBpbnN0YW5jZSBmb3IgY2hhaW5pbmcKICAgICAqIEB0eXBlIE9iamVjdAogICAgICovCgogICAga2VlcDogZnVuY3Rpb24gKGZpbHRlcikgewogICAgICB0aGlzLnJ1bGVzLmtlZXAoZmlsdGVyKTsKICAgICAgcmV0dXJuIHRoaXMKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBub2RlIHRoYXQgbWF0Y2hlcyB0aGUgZmlsdGVyCiAgICAgKiBAcHVibGljCiAgICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxGdW5jdGlvbn0gZmlsdGVyIFRoZSB1bmlxdWUga2V5IG9mIHRoZSBydWxlCiAgICAgKiBAcmV0dXJucyBUaGUgVHVybmRvd24gaW5zdGFuY2UgZm9yIGNoYWluaW5nCiAgICAgKiBAdHlwZSBPYmplY3QKICAgICAqLwoKICAgIHJlbW92ZTogZnVuY3Rpb24gKGZpbHRlcikgewogICAgICB0aGlzLnJ1bGVzLnJlbW92ZShmaWx0ZXIpOwogICAgICByZXR1cm4gdGhpcwogICAgfSwKCiAgICAvKioKICAgICAqIEVzY2FwZXMgTWFya2Rvd24gc3ludGF4CiAgICAgKiBAcHVibGljCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gZXNjYXBlCiAgICAgKiBAcmV0dXJucyBBIHN0cmluZyB3aXRoIE1hcmtkb3duIHN5bnRheCBlc2NhcGVkCiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwoKICAgIGVzY2FwZTogZnVuY3Rpb24gKHN0cmluZykgewogICAgICByZXR1cm4gZXNjYXBlcy5yZWR1Y2UoZnVuY3Rpb24gKGFjY3VtdWxhdG9yLCBlc2NhcGUpIHsKICAgICAgICByZXR1cm4gYWNjdW11bGF0b3IucmVwbGFjZShlc2NhcGVbMF0sIGVzY2FwZVsxXSkKICAgICAgfSwgc3RyaW5nKQogICAgfQogIH07CgogIC8qKgogICAqIFJlZHVjZXMgYSBET00gbm9kZSBkb3duIHRvIGl0cyBNYXJrZG93biBzdHJpbmcgZXF1aXZhbGVudAogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gcGFyZW50Tm9kZSBUaGUgbm9kZSB0byBjb252ZXJ0CiAgICogQHJldHVybnMgQSBNYXJrZG93biByZXByZXNlbnRhdGlvbiBvZiB0aGUgbm9kZQogICAqIEB0eXBlIFN0cmluZwogICAqLwoKICBmdW5jdGlvbiBwcm9jZXNzIChwYXJlbnROb2RlKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICByZXR1cm4gcmVkdWNlLmNhbGwocGFyZW50Tm9kZS5jaGlsZE5vZGVzLCBmdW5jdGlvbiAob3V0cHV0LCBub2RlKSB7CiAgICAgIG5vZGUgPSBuZXcgTm9kZShub2RlLCBzZWxmLm9wdGlvbnMpOwoKICAgICAgdmFyIHJlcGxhY2VtZW50ID0gJyc7CiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7CiAgICAgICAgcmVwbGFjZW1lbnQgPSBub2RlLmlzQ29kZSA/IG5vZGUubm9kZVZhbHVlIDogc2VsZi5lc2NhcGUobm9kZS5ub2RlVmFsdWUpOwogICAgICB9IGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICByZXBsYWNlbWVudCA9IHJlcGxhY2VtZW50Rm9yTm9kZS5jYWxsKHNlbGYsIG5vZGUpOwogICAgICB9CgogICAgICByZXR1cm4gam9pbihvdXRwdXQsIHJlcGxhY2VtZW50KQogICAgfSwgJycpCiAgfQoKICAvKioKICAgKiBBcHBlbmRzIHN0cmluZ3MgYXMgZWFjaCBydWxlIHJlcXVpcmVzIGFuZCB0cmltcyB0aGUgb3V0cHV0CiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge1N0cmluZ30gb3V0cHV0IFRoZSBjb252ZXJzaW9uIG91dHB1dAogICAqIEByZXR1cm5zIEEgdHJpbW1lZCB2ZXJzaW9uIG9mIHRoZSBvdXB1dAogICAqIEB0eXBlIFN0cmluZwogICAqLwoKICBmdW5jdGlvbiBwb3N0UHJvY2VzcyAob3V0cHV0KSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLnJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHsKICAgICAgaWYgKHR5cGVvZiBydWxlLmFwcGVuZCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIG91dHB1dCA9IGpvaW4ob3V0cHV0LCBydWxlLmFwcGVuZChzZWxmLm9wdGlvbnMpKTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIG91dHB1dC5yZXBsYWNlKC9eW1x0XHJcbl0rLywgJycpLnJlcGxhY2UoL1tcdFxyXG5cc10rJC8sICcnKQogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYW4gZWxlbWVudCBub2RlIHRvIGl0cyBNYXJrZG93biBlcXVpdmFsZW50CiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBub2RlIFRoZSBub2RlIHRvIGNvbnZlcnQKICAgKiBAcmV0dXJucyBBIE1hcmtkb3duIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBub2RlCiAgICogQHR5cGUgU3RyaW5nCiAgICovCgogIGZ1bmN0aW9uIHJlcGxhY2VtZW50Rm9yTm9kZSAobm9kZSkgewogICAgdmFyIHJ1bGUgPSB0aGlzLnJ1bGVzLmZvck5vZGUobm9kZSk7CiAgICB2YXIgY29udGVudCA9IHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKTsKICAgIHZhciB3aGl0ZXNwYWNlID0gbm9kZS5mbGFua2luZ1doaXRlc3BhY2U7CiAgICBpZiAod2hpdGVzcGFjZS5sZWFkaW5nIHx8IHdoaXRlc3BhY2UudHJhaWxpbmcpIGNvbnRlbnQgPSBjb250ZW50LnRyaW0oKTsKICAgIHJldHVybiAoCiAgICAgIHdoaXRlc3BhY2UubGVhZGluZyArCiAgICAgIHJ1bGUucmVwbGFjZW1lbnQoY29udGVudCwgbm9kZSwgdGhpcy5vcHRpb25zKSArCiAgICAgIHdoaXRlc3BhY2UudHJhaWxpbmcKICAgICkKICB9CgogIC8qKgogICAqIEpvaW5zIHJlcGxhY2VtZW50IHRvIHRoZSBjdXJyZW50IG91dHB1dCB3aXRoIGFwcHJvcHJpYXRlIG51bWJlciBvZiBuZXcgbGluZXMKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7U3RyaW5nfSBvdXRwdXQgVGhlIGN1cnJlbnQgY29udmVyc2lvbiBvdXRwdXQKICAgKiBAcGFyYW0ge1N0cmluZ30gcmVwbGFjZW1lbnQgVGhlIHN0cmluZyB0byBhcHBlbmQgdG8gdGhlIG91dHB1dAogICAqIEByZXR1cm5zIEpvaW5lZCBvdXRwdXQKICAgKiBAdHlwZSBTdHJpbmcKICAgKi8KCiAgZnVuY3Rpb24gam9pbiAob3V0cHV0LCByZXBsYWNlbWVudCkgewogICAgdmFyIHMxID0gdHJpbVRyYWlsaW5nTmV3bGluZXMob3V0cHV0KTsKICAgIHZhciBzMiA9IHRyaW1MZWFkaW5nTmV3bGluZXMocmVwbGFjZW1lbnQpOwogICAgdmFyIG5scyA9IE1hdGgubWF4KG91dHB1dC5sZW5ndGggLSBzMS5sZW5ndGgsIHJlcGxhY2VtZW50Lmxlbmd0aCAtIHMyLmxlbmd0aCk7CiAgICB2YXIgc2VwYXJhdG9yID0gJ1xuXG4nLnN1YnN0cmluZygwLCBubHMpOwoKICAgIHJldHVybiBzMSArIHNlcGFyYXRvciArIHMyCiAgfQoKICAvKioKICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gaW5wdXQgY2FuIGJlIGNvbnZlcnRlZAogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtTdHJpbmd8SFRNTEVsZW1lbnR9IGlucHV0IERlc2NyaWJlIHRoaXMgcGFyYW1ldGVyCiAgICogQHJldHVybnMgRGVzY3JpYmUgd2hhdCBpdCByZXR1cm5zCiAgICogQHR5cGUgU3RyaW5nfE9iamVjdHxBcnJheXxCb29sZWFufE51bWJlcgogICAqLwoKICBmdW5jdGlvbiBjYW5Db252ZXJ0IChpbnB1dCkgewogICAgcmV0dXJuICgKICAgICAgaW5wdXQgIT0gbnVsbCAmJiAoCiAgICAgICAgdHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJyB8fAogICAgICAgIChpbnB1dC5ub2RlVHlwZSAmJiAoCiAgICAgICAgICBpbnB1dC5ub2RlVHlwZSA9PT0gMSB8fCBpbnB1dC5ub2RlVHlwZSA9PT0gOSB8fCBpbnB1dC5ub2RlVHlwZSA9PT0gMTEKICAgICAgICApKQogICAgICApCiAgICApCiAgfQoKICByZXR1cm4gVHVybmRvd25TZXJ2aWNlOwoKfSgpKTsKCih3aW5kb3cgfHwgZ2xvYmFsVGhpcykuVHVybmRvd25TZXJ2aWNlID0gVHVybmRvd25TZXJ2aWNlOw==').then(%20()%20=>%20%7B%0A%0A%20%20const%20root%20=%20(window%20||%20globalThis)%3B%0A%20%20root.turndownService%20=%20new%20root.TurndownService()%3B%0A%20%20%7D%0A%20%20)%3B%0A%7D%0A%0Afunction%20execute()%20%7B%0A%20%20const%20rangeCount%20=%20window.getSelection().rangeCount%3B%0A%20%20if%20(rangeCount%20<%201)%20%7B%0A%20%20window.alert('No%20Selection%20Found')%3B%0A%20%20return%3B%0A%20%20%7D%0A%0A%20%20turndownMain()%3B%0A%7D%0A%0Aexecute()%3B%0A})();false;" 
                role="button"
            >Turndown Selection</a></p>
        </div>
    </div>

    
    <!--
    <div class="jumbotron">
        <a id="TURNDOWN_TRAILHEAD" name="TURNDOWN_TRAILHEAD"></a>
        <div class="container">
            <h1><a href="#TURNDOWN_TRAILHEAD">Turndown Selection</a></h1>
            <p>Converts a selection on any webpage to Markdown - for use in your own note taking</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet and enter your search term</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="" 
                role="button"
            >Turndown Trailhead</a></p>
        </div>
    </div>

    
    
    <div class="jumbotron">
        <a id="TURNDOWN_YOUTUBE" name="TURNDOWN_YOUTUBE"></a>
        <div class="container">
            <h1><a href="#TURNDOWN_YOUTUBE">Turndown Selection</a></h1>
            <p>Converts a selection on any webpage to Markdown - for use in your own note taking</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet and enter your search term</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="" 
                role="button"
            >Turndown Youtube</a></p>
        </div>
    </div>
    -->


    <div class="jumbotron">
        <a id="FORMAT_SELECTION" name="FORMAT_SELECTION"></a>
        <div class="container">
            <h1><a href="#FORMAT_SELECTION">Web Page Highlighter / Formatter</a></h1>
            <h3>Ever want to cross sections off on a webpage? Or want to take a highlighter to a section?</h3>
			<p>For example:
                <ul>
                    <li>Want to cross off items in an online recipe that were done?</li>
                    <li>Highlight particular phrases Red / Yellow / Green?</li>
                    <li>Black out a word for a screenshot?</li>
                </ul>
            </p>
            <p>To install, simply drag the Link / Button below to your bookmarks bar</p>
            <p>Then click the bookmarklet on the page you want to mark up - to see the toolbar</p>
            <p>Selecting text and then clicking on the style applies that style</p>
			<p class="bkmklt"><a class="btn btn-primary btn-lg"
                href="javascript:(function(){const%20getTextNodes%20=%20node%20=>%20%7B%0A%20%20switch%20(node.nodeType)%20%7B%0A%20%20case%20Node.TEXT_NODE:%0A%20%20return%20[node]%3B%0A%20%20case%20Node.ELEMENT_NODE:%0A%20%20case%20Node.DOCUMENT_NODE:%0A%20%20case%20Node.DOCUMENT_FRAGMENT_NODE:%0A%20%20return%20Array.prototype.map.call(%0A%20%20node.childNodes,%0A%20%20(childNode)%20=>%20getTextNodes(childNode)%0A%20%20).flat()%3B%0A%20%20default:%0A%20%20return%20[]%3B%0A%20%20%7D%0A%7D%3B%0A%0Aconst%20getNextClosestTextNode%20=%20(node,%20startOffset%20=%200)%20=>%20%7B%0A%20%20switch%20(node.nodeType)%20%7B%0A%20%20case%20Node.TEXT_NODE:%20%7B%0A%20%20if%20(startOffset%20<%20node.length)%20%7B%0A%20%20return%20node%3B%0A%20%20%7D%0A%20%20let%20nextClosestNode%20=%20null%3B%0A%20%20while%20(!(nextClosestNode%20=%20node.nextSibling)%20%26%26%20(node%20=%20node.parentNode))%3B%0A%20%20return%20nextClosestNode%20%3F%20getNextClosestTextNode(nextClosestNode)%20:%20null%3B%0A%20%20%7D%0A%20%20case%20Node.ELEMENT_NODE:%0A%20%20case%20Node.DOCUMENT_NODE:%0A%20%20case%20Node.DOCUMENT_FRAGMENT_NODE:%20%7B%0A%20%20const%20childNodes%20=%20node.childNodes%3B%0A%20%20const%20length%20=%20childNodes.length%3B%0A%20%20for%20(let%20i%20=%20startOffset%3B%20i%20<%20length%3B%20i%20+=%201)%20%7B%0A%20%20const%20textNode%20=%20getNextClosestTextNode(childNodes[i])%3B%0A%20%20if%20(textNode)%20%7B%0A%20%20return%20textNode%3B%0A%20%20%7D%0A%20%20%7D%0A%20%20let%20nextClosestNode%20=%20null%3B%0A%20%20while%20(!(nextClosestNode%20=%20node.nextSibling)%20%26%26%20(node%20=%20node.parentNode))%3B%0A%20%20return%20nextClosestNode%20%3F%20getNextClosestTextNode(nextClosestNode)%20:%20null%3B%0A%20%20%7D%0A%20%20default:%20%7B%0A%20%20let%20nextClosestNode%20=%20null%3B%0A%20%20while%20(!(nextClosestNode%20=%20node.nextSibling)%20%26%26%20(node%20=%20node.parentNode))%3B%0A%20%20return%20nextClosestNode%20%3F%20getNextClosestTextNode(nextClosestNode)%20:%20null%3B%0A%20%20%7D%0A%20%20%7D%0A%7D%3B%0A%0Aconst%20getPreviousClosestTextNode%20=%20(node,%20endOffset%20=%20node.length%20||%20node.childNodes.length)%20=>%20%7B%0A%20%20switch%20(node.nodeType)%20%7B%0A%20%20case%20Node.TEXT_NODE:%20%7B%0A%20%20if%20(endOffset%20>%200%20%26%26%20node.length%20>%200)%20%7B%0A%20%20return%20node%3B%0A%20%20%7D%0A%20%20let%20previousClosestNode%20=%20null%3B%0A%20%20while%20(!(previousClosestNode%20=%20node.previousSibling)%20%26%26%20(node%20=%20node.parentNode))%3B%0A%20%20return%20previousClosestNode%20%3F%20getPreviousClosestTextNode(previousClosestNode)%20:%20null%3B%0A%20%20%7D%0A%20%20case%20Node.ELEMENT_NODE:%0A%20%20case%20Node.DOCUMENT_NODE:%0A%20%20case%20Node.DOCUMENT_FRAGMENT_NODE:%20%7B%0A%20%20const%20childNodes%20=%20node.childNodes%3B%0A%20%20for%20(let%20i%20=%20endOffset%3B%20i%20>%200%3B%20i%20-=%201)%20%7B%0A%20%20const%20textNode%20=%20getPreviousClosestTextNode(childNodes[i])%3B%0A%20%20if%20(textNode)%20%7B%0A%20%20return%20textNode%3B%0A%20%20%7D%0A%20%20%7D%0A%20%20let%20previousClosestNode%20=%20null%3B%0A%20%20while%20(!(previousClosestNode%20=%20node.previousSibling)%20%26%26%20(node%20=%20node.parentNode))%3B%0A%20%20return%20previousClosestNode%20%3F%20getPreviousClosestTextNode(previousClosestNode)%20:%20null%3B%0A%20%20%7D%0A%20%20default:%20%7B%0A%20%20let%20previousClosestNode%20=%20null%3B%0A%20%20while%20(!(previousClosestNode%20=%20node.previousSibling)%20%26%26%20(node%20=%20node.parentNode))%3B%0A%20%20return%20previousClosestNode%20%3F%20getPreviousClosestTextNode(previousClosestNode)%20:%20null%3B%0A%20%20%7D%0A%20%20%7D%0A%7D%3B%0A%0Aconst%20splitContents%20=%20range%20=>%20%7B%0A%20%20const%20startContainer%20=%20range.startContainer%3B%0A%20%20const%20startOffset%20=%20range.startOffset%3B%0A%20%20switch%20(startContainer.nodeType)%20%7B%0A%20%20case%20Node.TEXT_NODE:%0A%20%20if%20(startOffset%20>%200)%20%7B%0A%20%20range.setStart(startContainer.splitText(startOffset),%200)%3B%0A%20%20%7D%0A%20%20break%3B%0A%20%20case%20Node.ELEMENT_NODE:%0A%20%20range.setStart(getNextClosestTextNode(startContainer,%20startOffset),%200)%3B%0A%20%20break%3B%0A%20%20default:%0A%20%20break%3B%0A%20%20%7D%0A%0A%20%20const%20endContainer%20=%20range.endContainer%3B%0A%20%20const%20endOffset%20=%20range.endOffset%3B%0A%20%20switch%20(endContainer.nodeType)%20%7B%0A%20%20case%20Node.TEXT_NODE:%0A%20%20if%20(endOffset%20<%20endContainer.length)%20%7B%0A%20%20endContainer.splitText(endOffset)%3B%0A%20%20%7D%0A%20%20break%3B%0A%20%20case%20Node.ELEMENT_NODE:%0A%20%20const%20textNode%20=%20getPreviousClosestTextNode(endContainer,%20endOffset)%3B%0A%20%20range.setEnd(textNode,%20textNode.length)%3B%0A%20%20break%3B%0A%20%20default:%0A%20%20break%3B%0A%20%20%7D%0A%7D%3B%0A%0Aconst%20createFormattedTextElement%20=%20(textNode,%20style)%20=>%20%7B%0A%20%20const%20formattedTextElement%20=%20document.createElement('formatted-text')%3B%0A%20%20Object.assign(formattedTextElement.style,%20style)%3B%0A%20%20textNode.parentNode.replaceChild(formattedTextElement,%20textNode)%3B%0A%20%20formattedTextElement.appendChild(textNode)%3B%0A%20%20return%20formattedTextElement%3B%0A%7D%3B%0A%0Aconst%20formatRange%20=%20(range,%20style)%20=>%20%7B%0A%20%20splitContents(range)%3B%0A%0A%20%20const%20commonAncestorContainer%20=%20range.commonAncestorContainer%3B%0A%20%20switch%20(commonAncestorContainer.nodeType)%20%7B%0A%20%20case%20Node.TEXT_NODE:%0A%20%20createFormattedTextElement(commonAncestorContainer,%20style)%3B%0A%20%20break%3B%0A%20%20case%20Node.ELEMENT_NODE:%0A%20%20const%20textNodes%20=%20getTextNodes(commonAncestorContainer)%3B%0A%20%20const%20textNodesEndOffset%20=%20textNodes.lastIndexOf(range.endContainer)%3B%0A%20%20for%20(let%20i%20=%20textNodes.indexOf(range.startContainer)%3B%20i%20<=%20textNodesEndOffset%3B%20i++)%20%7B%0A%20%20createFormattedTextElement(textNodes[i],%20style)%3B%0A%20%20%7D%0A%20%20break%3B%0A%20%20default:%0A%20%20break%3B%0A%20%20%7D%0A%7D%3B%0A%0Aconst%20getSelections%20=%20(frame%20=%20window)%20=>%20%7B%0A%20%20try%20%7B%0A%20%20const%20selection%20=%20frame.getSelection()%3B%0A%20%20return%20selection%20%26%26%20selection.rangeCount%20>%200%0A%20%20%3F%20[selection,%20...Array.prototype.flatMap.call(frame.frames,%20(frame2)%20=>%20getSelections(frame2))]%0A%20%20:%20Array.prototype.flatMap.call(frame.frames,%20(frame2)%20=>%20getSelections(frame2))%3B%0A%20%20%7D%20catch%20(error)%20%7B%0A%20%20return%20[]%3B%0A%20%20%7D%0A%7D%3B%0A%0Aconst%20formatSelections%20=%20(style)%20=>%20%7B%0A%20%20for%20(const%20selection%20of%20getSelections())%20%7B%0A%20%20const%20selectionRangeCount%20=%20selection.rangeCount%3B%0A%20%20for%20(let%20i%20=%200%3B%20i%20<%20selectionRangeCount%3B%20i++)%20%7B%0A%20%20try%20%7B%0A%20%20formatRange(selection.getRangeAt(i),%20style)%3B%0A%20%20%7D%20catch%20(error)%20%7B%0A%20%20console.error(error)%3B%0A%20%20%7D%0A%20%20%7D%0A%20%20selection.removeAllRanges()%3B%0A%20%20%7D%0A%7D%3B%0A%0Aconst%20createFormatUIIframeElement%20=%20()%20=>%20%7B%0A%20%20const%20iframeElement%20=%20document.createElement('iframe')%3B%0A%20%20document.body.appendChild(iframeElement)%3B%0A%20%20const%20iframeDocument%20=%20iframeElement.contentDocument%3B%0A%20%20iframeDocument.open()%3B%0A%20%20iframeDocument.write(%60%0A%20%20<!DOCTYPE%20html>%0A%20%20<html%20lang=%22en%22>%0A%20%20<head>%0A%20%20<meta%20charset=%22utf-8%22>%0A%20%20<meta%20name=%22viewport%22%20content=%22width=device-width,%20initial-scale=1,%20shrink-to-fit=no%22>%0A%20%20</head>%0A%20%20<body>%0A%20%20<main>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-bold%22%20title=%22Bold%22%20aria-label=%22Bold%22%20data-text-format-picker-value=%22font-weight=bold%22><span%20aria-hidden=%22true%22>B</span></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-italic%22%20title=%22Italic%22%20aria-label=%22Italic%22%20data-text-format-picker-value=%22font-style=italic%22><span%20aria-hidden=%22true%22>I</span></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-underline%22%20title=%22Underline%22%20aria-label=%22Underline%22%20data-text-format-picker-value=%22text-decoration=underline%22><span%20aria-hidden=%22true%22>U</span></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-strikethrough%22%20title=%22Strikethrough%22%20aria-label=%22Strikethrough%22%20data-text-format-picker-value=%22text-decoration=line-through%22><span%20aria-hidden=%22true%22>ab</span></button>%0A%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%20text-format-picker-item-color-black%22%20title=%22Black%22%20aria-label=%22Black%22%20data-text-format-picker-value=%22background-color=black%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%20text-format-picker-item-color-gray%22%20title=%22Gray%22%20aria-label=%22Gray%22%20data-text-format-picker-value=%22background-color=gray%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%20text-format-picker-item-color-silver%22%20title=%22Silver%22%20aria-label=%22Silver%22%20data-text-format-picker-value=%22background-color=silver%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%20text-format-picker-item-color-white%22%20title=%22White%22%20aria-label=%22White%22%20data-text-format-picker-value=%22background-color=white%22></button>%0A%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color-custom%22%20title=%22Custom%22%20aria-label=%22Custom%22%20data-text-format-picker-value=%22background-color=#b8faff%22%20style=%22background-color:rgb(184,255,255)%22></button>%0A%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Pink%22%20aria-label=%22Pink%22%20data-text-format-picker-value=%22background-color=rgb(253,138,129)%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Red%22%20aria-label=%22Red%22%20data-text-format-picker-value=%22background-color=red%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Orange%22%20aria-label=%22Orange%22%20data-text-format-picker-value=%22background-color=orange%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Yellow%22%20aria-label=%22Yellow%22%20data-text-format-picker-value=%22background-color=yellow%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Lime%22%20aria-label=%22Lime%22%20data-text-format-picker-value=%22background-color=lime%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Aqua%22%20aria-label=%22Aqua%22%20data-text-format-picker-value=%22background-color=aqua%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Blue%22%20aria-label=%22Blue%22%20data-text-format-picker-value=%22background-color=rgb(130,165,255)%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Violet%22%20aria-label=%22Violet%22%20data-text-format-picker-value=%22background-color=rgb(171,130,248)%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22LightPurple%22%20aria-label=%22LightPurple%22%20data-text-format-picker-value=%22background-color=rgb(242,144,249)%22></button>%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-color%22%20title=%22Fuchsia%22%20aria-label=%22Fuchsia%22%20data-text-format-picker-value=%22background-color=fuchsia%22></button>%0A%0A%20%20<input%20class=%22text-format-picker-item%20text-format-picker-item-color-picker%22%20type=%22color%22%20value=%22#b8faff%22%20title=%22Color%20picker%22%20aria-label=%22Color%20picker%22>%0A%0A%20%20<button%20class=%22text-format-picker-item%20text-format-picker-item-cancel%22%20title=%22Cancel%22%20aria-label=%22Cancel%22>Cancel</button>%0A%20%20</main>%0A%20%20</body>%0A%20%20</html>%0A%20%20%60)%3B%0A%20%20iframeDocument.close()%3B%0A%0A%20%20let%20cssStyleSheet%20=%20null%3B%0A%20%20return%20new%20Promise((resolve,%20reject)%20=>%20%7B%0A%20%20if%20(document.readyState%20===%20'interactive'%20||%20document.readyState%20===%20'complete')%20%7B%0A%20%20resolve()%3B%0A%20%20%7D%20else%20%7B%0A%20%20iframeElement.addEventListener('load',%20resolve,%20%7B%20once:%20true%20%7D)%3B%0A%20%20iframeElement.addEventListener('error',%20reject,%20%7B%20once:%20true%20%7D)%3B%0A%20%20%7D%0A%20%20%7D)%0A%20%20.then(%0A%20%20()%20=>%20new%20Promise((resolve,%20reject)%20=>%20%7B%0A%20%20const%20styleElement%20=%20iframeDocument.head.appendChild(iframeDocument.createElement('style'))%3B%0A%20%20const%20styleElementSheet%20=%20styleElement.sheet%3B%0A%20%20if%20(styleElementSheet%20%26%26%20styleElementSheet.cssRules)%20%7B%0A%20%20cssStyleSheet%20=%20styleElementSheet%3B%0A%20%20resolve()%3B%0A%20%20%7D%20else%20%7B%0A%20%20styleElement.remove()%3B%0A%20%20reject()%3B%0A%20%20%7D%0A%20%20%7D)%0A%20%20.catch(%0A%20%20()%20=>%20new%20Promise((resolve,%20reject)%20=>%20%7B%0A%20%20let%20linkElement%20=%20null%3B%0A%20%20for%20(const%20styleSheet%20of%20document.styleSheets)%20%7B%0A%20%20try%20%7B%0A%20%20if%20(styleSheet.cssRules)%20%7B%0A%20%20linkElement%20=%20styleSheet.ownerNode%3B%0A%20%20break%3B%0A%20%20%7D%0A%20%20%7D%20catch%20(error)%20%7B%0A%20%20console.error(error)%3B%0A%20%20%7D%0A%20%20%7D%0A%20%20if%20(linkElement)%20%7B%0A%20%20linkElement%20=%20linkElement.cloneNode(true)%3B%0A%20%20linkElement.addEventListener('load',%20()%20=>%20%7B%20resolve(linkElement)%3B%20%7D,%20%7B%20once:%20true%20%7D)%3B%0A%20%20linkElement.addEventListener('error',%20reject,%20%7B%20once:%20true%20%7D)%3B%0A%20%20iframeDocument.head.appendChild(linkElement)%3B%0A%20%20%7D%20else%20%7B%0A%20%20reject()%3B%0A%20%20%7D%0A%20%20%7D)%0A%20%20.then(linkElement%20=>%20%7B%0A%20%20cssStyleSheet%20=%20linkElement.sheet%3B%0A%20%20%7D)%0A%20%20)%0A%20%20)%0A%20%20.then(()%20=>%20%7B%0A%20%20for%20(let%20i%20=%20cssStyleSheet.cssRules.length%3B%20i--%20>%200%3B%20)%20%7B%0A%20%20cssStyleSheet.deleteRule(i)%3B%0A%20%20%7D%0A%20%20const%20cssRules%20=%20[%0A%20%20%60*%20%7B%0A%20%20box-sizing:%20border-box%3B%0A%20%20%7D%60,%0A%20%20%60html%20%7B%0A%20%20font-size:%2012px%3B%0A%20%20%7D%60,%0A%20%20%60body%20%7B%0A%20%20display:%20inline-block%3B%0A%20%20font-family:%20system-ui,%20-apple-system,%20%22Segoe%20UI%22,%20Roboto,%20%22Helvetica%20Neue%22,%20Arial,%20%22Noto%20Sans%22,%20%22Liberation%20Sans%22,%20sans-serif%3B%0A%20%20font-size:%201rem%3B%0A%20%20line-height:%201.5%3B%0A%20%20margin:%200%3B%0A%20%20-webkit-tap-highlight-color:%20rgba(0,0,0,0)%3B%0A%20%20-webkit-text-size-adjust:%20100%%3B%0A%20%20%7D%60,%0A%20%20%60button,%20input%20%7B%0A%20%20font-family:%20inherit%3B%0A%20%20font-size:%20inherit%3B%0A%20%20line-height:%20inherit%3B%0A%20%20margin:%200%3B%0A%20%20%7D%60,%0A%20%20%60button%20%7B%0A%20%20-webkit-appearance:%20button%3B%0A%20%20border-radius:%200%3B%0A%20%20text-transform:%20none%3B%0A%20%20%7D%60,%0A%20%20%60button:focus:not(:focus-visible)%20%7B%0A%20%20outline:%200%3B%0A%20%20%7D%60,%0A%20%20%60main%20%7B%0A%20%20background:%20padding-box%20#fff%3B%0A%20%20border:%201px%20solid%20rgba(0,0,0,.15)%3B%0A%20%20border-radius:%20.25rem%3B%0A%20%20color:%20#212529%3B%0A%20%20display:%20inline-grid%3B%0A%20%20gap:%20.5rem%202px%3B%0A%20%20grid:%20[font-style%20grayscale]%202rem%20[color]%202rem%20[cancel]%202rem%20/%20repeat(12,%202rem)%3B%0A%20%20padding:%20.5rem%3B%0A%20%20%7D%60,%0A%20%20%60@media%20(prefers-color-scheme:%20dark)%20%7B%0A%20%20main%20%7B%0A%20%20background-color:%20#343a40%3B%0A%20%20color:%20#dee2e6%3B%0A%20%20%7D%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item%20%7B%0A%20%20background-color:%20#fff%3B%0A%20%20border:%201px%20solid%20#dee2e6%3B%0A%20%20border-radius:%201px%3B%0A%20%20padding:%200%3B%0A%20%20position:%20relative%3B%0A%20%20text-align:%20center%3B%0A%20%20transition:%20border-color%20.15s%20ease-in-out,%20box-shadow%20.15s%20ease-in-out%3B%0A%20%20vertical-align:%20middle%3B%0A%20%20%7D%60,%0A%20%20%60@media%20(prefers-reduced-motion:%20reduce)%20%7B%0A%20%20.text-format-picker-item%20%7B%0A%20%20transition:%20none%3B%0A%20%20%7D%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item:focus%20%7B%0A%20%20border-color:%20#ffc107%3B%0A%20%20box-shadow:%200%200%200%20.25rem%20rgba(255,193,7,.5)%3B%0A%20%20outline:%200%3B%0A%20%20z-index:%201%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item:hover%20%7B%0A%20%20border-color:%20#ffc107%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-bold,%0A%20%20.text-format-picker-item-italic,%0A%20%20.text-format-picker-item-underline,%0A%20%20.text-format-picker-item-strikethrough%20%7B%0A%20%20font-family:%20Verdana,%20system-ui,%20-apple-system,%20%22Segoe%20UI%22,%20Roboto,%20%22Helvetica%20Neue%22,%20Arial,%20%22Noto%20Sans%22,%20%22Liberation%20Sans%22,%20sans-serif%3B%0A%20%20grid-row-start:%20font-style%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-bold,%0A%20%20.text-format-picker-item-italic,%0A%20%20.text-format-picker-item-underline%20%7B%0A%20%20font-size:%201.166667rem%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-bold%20%7B%0A%20%20font-weight:%20bold%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-italic%20%7B%0A%20%20font-style:%20italic%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-underline%20%7B%0A%20%20text-decoration:%20underline%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-strikethrough%20%7B%0A%20%20text-decoration:%20line-through%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color%20%7B%0A%20%20grid-row:%20color%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-black,%0A%20%20.text-format-picker-item-color-gray,%0A%20%20.text-format-picker-item-color-silver,%0A%20%20.text-format-picker-item-color-white,%0A%20%20.text-format-picker-item-color-custom%20%7B%0A%20%20grid-row:%20grayscale%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-black%20%7B%0A%20%20grid-column:%206%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-gray%20%7B%0A%20%20grid-column:%207%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-silver%20%7B%0A%20%20grid-column:%208%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-white%20%7B%0A%20%20grid-column:%209%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-custom%20%7B%0A%20%20grid-column:%2012%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-picker%20%7B%0A%20%20grid-area:%20color%20/%20auto%20/%20auto%20/%20span%202%3B%0A%20%20height:%20100%%3B%0A%20%20padding:%20.25rem%20.5rem%3B%0A%20%20width:%20100%%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-picker::-webkit-color-swatch%20%7B%0A%20%20border-radius:%201px%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-color-picker::-webkit-color-swatch-wrapper%20%7B%0A%20%20padding:%200%3B%0A%20%20%7D%60,%0A%20%20%60.text-format-picker-item-cancel%20%7B%0A%20%20color:%20#212529%3B%0A%20%20grid-area:%20cancel%20/%20auto%20/%20auto%20/%20span%2012%3B%0A%20%20%7D%60%0A%20%20]%3B%0A%20%20for%20(const%20cssRule%20of%20cssRules.reverse())%20%7B%0A%20%20try%20%7B%0A%20%20cssStyleSheet.insertRule(cssRule)%3B%0A%20%20%7D%20catch%20(error)%20%7B%0A%20%20console.error(error)%3B%0A%20%20%7D%0A%20%20%7D%0A%0A%20%20const%20%7B%20offsetHeight:%20iframeHeight,%20offsetWidth:%20iframeWidth%20%7D%20=%20iframeDocument.body%3B%0A%20%20const%20iframeElementStyle%20=%20iframeElement.style%3B%0A%20%20iframeElementStyle.border%20=%20'0'%3B%0A%20%20iframeElementStyle.height%20=%20iframeHeight%20+%20'px'%3B%0A%20%20iframeElementStyle.opacity%20=%20'1'%3B%0A%20%20iframeElementStyle.position%20=%20'fixed'%3B%0A%20%20const%20prefersReducedMotionReduce%20=%20matchMedia('(prefers-reduced-motion:%20reduce)').matches%3B%0A%20%20iframeElementStyle.transition%20=%20prefersReducedMotionReduce%20%3F%20'none'%20:%20'opacity%20500ms'%3B%0A%20%20iframeElementStyle.width%20=%20iframeWidth%20+%20'px'%3B%0A%20%20iframeElementStyle.zIndex%20=%20'9999'%3B%0A%20%20iframeElementStyle.right%20=%20'10px'%3B%0A%20%20iframeElementStyle.top%20=%20'50%'%3B%0A%20%20iframeElementStyle.transform%20=%20'translateY(-50%)'%3B%0A%0A%20%20const%20iframeMain%20=%20iframeDocument.getElementsByTagName('main')[0]%3B%0A%20%20function%20cleanMain()%20%7B%0A%20%20[...iframeMain.getElementsByTagName('formatted-text')].forEach((el)%20=>%20el.remove())%3B%0A%20%20%7D%0A%0A%20%20for%20(const%20textFormatPickerItemColor%20of%20iframeDocument.getElementsByClassName('text-format-picker-item-color'))%20%7B%0A%20%20const%20textFormatPickerValueKeyValuePairs%20=%20%7B%7D%3B%0A%20%20for%20(const%20keyValuePair%20of%20textFormatPickerItemColor.getAttribute('data-text-format-picker-value').trim().split(/\s*%26\s*/g))%20%7B%0A%20%20const%20%7B%200:%20key,%201:%20value%20%7D%20=%20keyValuePair.split(/\s*=\s*/g)%3B%0A%20%20textFormatPickerValueKeyValuePairs[key]%20=%20value%3B%0A%20%20%7D%0A%20%20textFormatPickerItemColor.style.backgroundColor%20=%20textFormatPickerValueKeyValuePairs['background-color']%3B%0A%20%20textFormatPickerItemColor.addEventListener('click',%20()%20=>%20%7B%0A%20%20formatSelections(textFormatPickerValueKeyValuePairs)%3B%0A%20%20cleanMain()%3B%0A%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20for%20(const%20textFormatPickerItem%20of%20iframeDocument.querySelectorAll('.text-format-picker-item-bold,%20.text-format-picker-item-italic,%20.text-format-picker-item-underline,%20.text-format-picker-item-strikethrough'))%20%7B%0A%20%20const%20textFormatPickerValueKeyValuePairs%20=%20%7B%7D%3B%0A%20%20for%20(const%20keyValuePair%20of%20textFormatPickerItem.getAttribute('data-text-format-picker-value').trim().split(/\s*%26\s*/g))%20%7B%0A%20%20const%20%7B%200:%20key,%201:%20value%20%7D%20=%20keyValuePair.split(/\s*=\s*/g)%3B%0A%20%20textFormatPickerValueKeyValuePairs[key]%20=%20value%3B%0A%20%20%7D%0A%20%20textFormatPickerItem.addEventListener('click',%20()%20=>%20%7B%0A%20%20formatSelections(textFormatPickerValueKeyValuePairs)%3B%0A%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20const%20textFormatPickerItemColorPicker%20=%20iframeDocument.getElementsByClassName('text-format-picker-item-color-picker')[0]%3B%0A%20%20textFormatPickerItemColorPicker.addEventListener('change',%20()%20=>%20%7B%0A%20%20formatSelections(%7B%20backgroundColor:%20textFormatPickerItemColorPicker.value%20%7D)%3B%0A%20%20%0A%20%20iframeDocument.getElementsByClassName('text-format-picker-item-color-custom')[0].style.backgroundColor%20=%20textFormatPickerItemColorPicker.value%3B%0A%20%20iframeDocument.getElementsByClassName('text-format-picker-item-color-custom')[0].dataset.textFormatPickerValue%20=%20textFormatPickerItemColorPicker.value%3B%0A%0A%20%20cleanMain()%3B%0A%20%20%7D)%3B%0A%0A%20%20const%20textFormatPickerItemCustomColor%20=%20iframeDocument.getElementsByClassName('text-format-picker-item-color-custom')[0]%3B%0A%20%20textFormatPickerItemCustomColor.addEventListener('click',%20(el)%20=>%20%7B%0A%20%20formatSelections(%7B%20backgroundColor:%20textFormatPickerItemCustomColor.style.backgroundColor%20%7D)%3B%0A%20%20cleanMain()%3B%0A%20%20%7D)%3B%0A%0A%20%20iframeDocument.getElementsByClassName('text-format-picker-item-cancel')[0].addEventListener('click',%20()%20=>%20%7B%0A%20%20iframeElement.remove()%3B%0A%20%20%7D)%3B%0A%0A%20%20iframeElement.focus()%3B%0A%0A%20%20return%20iframeElement%3B%0A%20%20%7D,%0A%20%20()%20=>%20%7B%0A%20%20iframeElement.remove()%3B%0A%20%20formatSelections(%7B%20backgroundColor:%20'yellow'%20%7D)%3B%0A%20%20%7D%0A%20%20)%3B%0A%7D%3B%0A%0AcreateFormatUIIframeElement()%3B%0A})();false;" 
                role="button"
            >Format Selection</a></p>
        </div>
    </div>
	
    
    <div class="jumbotron">
        <a id="COPY_TABLE" name="COPY_TABLE"></a>
        <div class="container">
            <h1><a href="#COPY_TABLE">Copy Table To Clipboard</a></h1>
            <p>Places a selected HTML Table into your clipboard</p>
			<p>To use, simply select somewhere within a table you wish to copy (used to identify which table)</p>
			<p>Then click the bookmarklet</p>
			<p>Then go to a spreadsheet and paste. TADAH!</p>
            <p>To install, drag the link below to your bookmarks bar</p>
			<p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function()%7Bfunction%20getSelectedNode()%7Bif(document.selection)return%20document.selection.createRange().parentElement()%3Belse%7Bvar%20selection%3Dwindow.getSelection()%3Bif(selection.rangeCount%3E0)return%20selection.getRangeAt(0).startContainer.parentNode%3B%7D%7Dfunction%20copyToClipboard(text)%7Btry%7Bif(window.clipboardData%26%26window.clipboardData.setData)%7Breturn%20clipboardData.setData(%27Text%27%2Ctext)%3B%7Delse%20if(document.queryCommandSupported%26%26document.queryCommandSupported(%27copy%27))%7Btry%7Bnavigator.clipboard.writeText(text)%3Breturn%3B%7Dcatch(ex)%7B%7Dvar%20textarea%3Ddocument.createElement(%27textarea%27)%3Btextarea.textContent%3Dtext%3Btextarea.style.position%3D%27fixed%27%3Btextarea.style.left%3D%27-999999px%27%3Btextarea.style.top%3D%27-999999px%27%3Bdocument.body.appendChild(textarea)%3Btextarea.focus()%3Btextarea.select()%3Breturn%20new%20Promise((response%2Creject)%3D%3E%7Btry%7Bdocument.execCommand(%27copy%27)%3Fresponse()%3Areject()%3Btextarea.remove()%3B%7Dcatch(err)%7Bconsole.warn(%27copy%20attempt%202%20failed%27%2Cerr)%3B%7D%7D)%3B%7Delse%7Balert(%27No%20copy%20feature%20available%20in%20this%20context%27)%3B%7D%7Dcatch(err)%7Bconsole.error(%27copy%20to%20clipboard%20failed%27%2Cerr)%3Balert(%27copy%20to%20clipboard%20failed%27)%3B%7D%7Dfunction%20tableToArray(currentTable)%7Breturn%20Array.from(currentTable.querySelectorAll(%27tr%27)).map(trEl%3D%3EArray.from(trEl.querySelectorAll(%27td%2Cth%27)).map(tdEl%3D%3EtdEl.innerText))%7Dfunction%20escapeCell(val)%7Blet%20val2%3D(val%7C%7C%27%27)%3Bval2%3Dval2.replace(%2F(%5B%5Ct%27%5D)%2Fg%2C%20%27%5C%5C%241%27)%3B%20val2%3Dval2.replace(%2F%22%2Fg%2C%27%22%22%27)%3Bval2%3Dval2.replace(%2F%5Cn%2Fg%2C%27%5C%5Cn%27)%3Breturn%20%60%22%24%7Bval2%7D%22%60%3B%7Dfunction%20tableToTSV(tableArray)%7Breturn%20tableArray.map(row%3D%3Erow.map(escapeCell).join(%27%5Ct%27)).join(%27%5Cn%27)%3B%7Dvar%20selectedElement%3DgetSelectedNode()%3Bvar%20selectedTable%3DselectedElement%3FselectedElement.closest(%27table%27)%3Anull%3Bif(!selectedTable)%7Balert(%27No%20selection%20found.%20Please%20select%20within%20the%20table%20to%20copy%27)%3B%7DcopyToClipboard(tableToTSV(tableToArray(selectedTable)))%3B%7D)()%3B" 
                role="button"
            >Copy Table</a></p>
        </div>
    </div>
    
    
    <div class="jumbotron">
        <a id="RENAME_WINDOW" name="RENAME_WINDOW"></a>
        <div class="container">
            <h1><a href="#RENAME_WINDOW">Rename Window</a></h1>
            <p>Helpful link to allow you to rename windows, so expos&eacute; shows windows in a way that you can tell what is what</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet and enter your search term</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){window.document.title=window.prompt('New window title?');})()" 
                role="button"
            >Rename Window</a></p>
        </div>
    </div>


    <div class="jumbotron">
        <a id="Ramda" name="RAMDA"></a>
        <div class="container">
            <h1><a href="#RAMDA">Inject Ramda</a></h1>
            <p>Injects <a href='https://ramdajs.com/docs/'>Ramda</a></p>
            <p><a target='_blank' href='https://github.com/ramda/ramda/blob/master/BOOKMARKLET.md' >From Here</a></p>
        </div>
    </div>
	
    
    <div class="jumbotron">
        <a id="CONFIRM_CLOSE" name="CONFIRM_CLOSE"></a>
        <div class="container">
            <h1><a href="#CONFIRM_CLOSE">Confirm Closing this Tab</a></h1>
			<p>After clicking this bookmarklet, you&apos;ll be asked to confirm when moving away.</p>
			<p>This can be quite nice to remember to do something before finishing for the day.</p>
            <p>Such as, you got a notification on certs you should handle later today...</p>
            <p>Even if you try closing the whole window and it is buried in one of the tabs, it can confirm before it does anything.</p>
            <p>To install, drag the link below to your bookmarks bar</p>
			<p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){window.onbeforeunload=(evt)=>{return 'discard changes?';}})();"
                role="button"
            >Confirm Close</a></p>
        </div>
    </div>

    <div class="jumbotron">
        <a id="SHARE_GCAL_EVENT" name="SHARE_GCAL_EVENT"></a>
        <div class="container">
            <h1><a href="#SHARE_GCAL_EVENT">Share GCal Event</a></h1>
            <p>Provides a link for a gCal Event for other participants to directly navigate to.</p>
			<p>To install, drag the link below to your bookmarks bar</p>
			<p>Then, click the bookmarklet when the Calendar Event is open, and copy the link</p>
			<p>(either with details shown or in the edit screen)</p>
    		<p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){loc%3Dwindow.location.href%2CopenPanel%3Ddocument.querySelector%28%22%5Bisfullscreen%5D%22%29%2CeventId%3D%22%22%2Cloc.indexOf%28%22%2Feventedit%2F%22%29%3E-1%3F%28eventId%3Dloc.split%28%22%2Feventedit%2F%22%29%5B1%5D%2CeventId%3DeventId.split%28%22%3F%22%29%5B0%5D%2CeventId%3DeventId.split%28%22%26%22%29%5B0%5D%29%3AopenPanel%26%26openPanel.querySelector%28%22%5Bdata-eventid%5D%22%29%3FeventId%3DopenPanel.querySelector%28%22%5Bdata-eventid%5D%22%29.getAttribute%28%22data-eventid%22%29%3Aalert%28%22Select%20an%20event%20in%20Google%20Calendar%20to%20begin%22%29%2CeventId%26%26%28address%3D%60https%3A%2F%2Fwww.google.com%2Fcalendar%2Fevent%3Feid%3D%24%7BeventId%7D%60%2Cwindow.prompt%28%22Share%20this%20URL%3A%22%2Caddress%29%29%3B})();"
                role="button" 
            >Share GCal Event</a></p>
        </div>
    </div>

    <!--
    // gcal
	loc = window.location.href;

	openPanel = document.querySelector('[isfullscreen]');
	eventId = '';

	if (loc.indexOf("/eventedit/") > -1) {
	  eventId = loc.split("/eventedit/")[1];
	  eventId = eventId.split('?')[0];
	  eventId = eventId.split('&')[0];
	} else if (openPanel && openPanel.querySelector('[data-eventid]')) {
	  eventId = openPanel.querySelector('[data-eventid]').getAttribute('data-eventid');
	} else {
	  alert('Select an event in Google Calendar to begin');
	}

	if (eventId) {
	  address = `https://www.google.com/calendar/event?eid=${eventId}`;
	  window.prompt('Share this URL:', address);
	}
    -->

    
    <div class="jumbotron">
        <a id="SHARE_GMAIL_THREAD" name="SHARE_GMAIL_THREAD"></a>
        <div class="container">
            <h1><a href="#SHARE_GMAIL_THREAD">Link to GMail Thread</a></h1>        	
        	<p>Sometimes you want to bookmark an email thread to come back to it</p>
        	<p>Or you want to tell someone to go look for an email thread</p>
        	<p>This bookmark creates / navigates you to a search page url you can forward</p>
        	<p>This keeps security in mind, as the search will only find something if someone can see it.</p>
        	<p>(In other words, you can't link to an email someone can't see otherwise)</p>
   	        <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){messageId%3D%22%22%2CmessageIdEl%3Ddocument.querySelector%28%22td.message_id%22%29%2C%22mail.google.com%22%21%3D%3Dwindow.location.host%3Falert%28%22Please%20go%20to%20an%20email%20within%20GMail%20to%20use.%22%29%3AmessageIdEl%3F%28messageId%3DmessageIdEl.innerText.replace%28%2F%5B%3C%3E%5D%2Fg%2C%22%22%29%2Caddress%3D%22https%3A%2F%2Fmail.google.com%2Fmail%2Fu%2F0%2F%23search%2F%22%2BencodeURIComponent%28%22rfc822msgid%3A%22%2BmessageId%29%2Cwindow.prompt%28%22Share%20this%20URL%5Cn%28NOTE%3A%20it%20is%20effectively%20a%20search%20link%2C%20to%20avoid%20security%20leaks%29%22%2Caddress%29%29%3Adocument.querySelector%28%22h2%5Bdata-thread-perm-id%5D%22%29%3Falert%28%22Within%20the%20%28%E2%8B%AE%29%20Menu%2C%20click%20SHOW%20ORIGINAL%20to%20continue%22%29%3Aalert%28%22Navigate%20to%20an%20Email%2C%20then%20Show%20Original%20to%20continue%22%29%3B})();"
                role="button" 
            >Share GMail</a></a>
        </div>
    </div>

    <!--
    // gmail
    messageId = '';
    messageIdEl = document.querySelector('td.message_id');
    if (window.location.host !== 'mail.google.com') {
        alert('Please go to an email within GMail to use.');
    } else if(messageIdEl) {
        messageId = messageIdEl.innerText.replace(/[<>]/g, '');
        address = 'https://mail.google.com/mail/u/0/#search/' + encodeURIComponent('rfc822msgid:' + messageId);
    
        window.prompt('Share this URL\n(NOTE: it is effectively a search link, to avoid security leaks)', address);
    } else if(!document.querySelector('h2[data-thread-perm-id]')) {
        alert('Navigate to an Email, then Show Original to continue');
    } else {
        alert('Within the (⋮) Menu, click SHOW ORIGINAL to continue');
    }
    -->

    <div class="jumbotron">
        <a id="SEARCH_WITHIN_GDRIVE" name="SEARCH_WITHIN_GDRIVE"></a>
        <div class="container">
            <h1><a href="#SEARCH_WITHIN_GDRIVE">Search within GDrive Folder</a></h1>
            <p>Sometimes you just want to find README.MD within a specific google drive folder</p>
            <p>And not have the search include every README.MD file ever to exist</p>
            <p>Navigate to a Google Drive Folder, and click the bookmarklet</p>
            <p>The search it takes you to filters to only that folder</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){loc%3Dwindow.location.href%2Cloc.indexOf%28%22%2Fdrive%2F%22%29%3C0%3Falert%28%22Navigate%20to%20a%20Google%20Drive%20Folder%20to%20begin%22%29%3Aloc.indexOf%28%22%2Ffolders%2F%22%29%3C0%3Falert%28%22Navigate%20to%20a%20Google%20Drive%20Folder%20to%20begin%22%29%3A%28fileName%3Dprompt%28%22Search%20within%20this%20Google%20Drive%20Folder%3A%22%2C%22%22%29%2Cnull%21%3D%3DfileName%26%26%28folderId%3Dloc.split%28%22%2Ffolders%2F%22%29%5B1%5D%2CfolderId%3DfolderId.split%28%22%3F%22%29%5B0%5D%2CfolderId%3DfolderId.split%28%22%26%22%29%5B0%5D%2Caddress%3D%22https%3A%2F%2Fdrive.google.com%2Fdrive%2Fsearch%3Fq%3D%22%2BencodeURIComponent%28%22parent%3A%22%2BfolderId%2B%22%20%22%2BfileName%29%2Cwindow.location.href%3Daddress%29%29%3B})();"
                role="button" 
            >Search GFolder</a></p>
        </div>
    </div>

    <!--
	loc = window.location.href;
	if (loc.indexOf('/drive/') < 0) {
	    alert('Navigate to a Google Drive Folder to begin');
	} else if (loc.indexOf('/folders/') < 0) {
	    alert('Navigate to a Google Drive Folder to begin');
	} else {
	    fileName = prompt('Search within this Google Drive Folder:', '');
	
	    if (fileName !== null) {
	        folderId = loc.split('/folders/')[1];
	        folderId = folderId.split('?')[0];
	        folderId = folderId.split('&')[0];    
	    
	        address = 'https://drive.google.com/drive/search?q=' + encodeURIComponent('parent:' + folderId + ' ' + fileName);
	    
	        window.location.href = address;
	    }
	}
    -->

    <div class="jumbotron">
        <a id="OPEN_GDRIVE_FOLDER" name="OPEN_GDRIVE_FOLDER"></a>
        <div class="container">
            <h1><a href="#OPEN_GDRIVE_FOLDER">Open Selected GDrive Folder In New Window</a></h1>
            <p>Sometimes you want to open a GDrive folder, in a new window,</p>
            <p> so you don&apos;t lose your place</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function()%7Bconst target=%5B...document.querySelectorAll('c-wiz div%5Brole=%22row%22%5D%5Baria-selected=%22true%22%5D')%5D;if(target.length&gt;0)%7Bfor(var i=0;i<target.length;i++)%7Bconst cTarget=target%5Bi%5D;const driveFolderId=cTarget.parentElement.getAttribute('data-id');window.open('https://drive.google.com/drive/folders/'+driveFolderId,'_blank');%7D%7Delse%7Bwindow.alert('No Folder Selected');%7D%7D)();"
                role="button" 
            >Open GFolder</a></p>
        </div>
    </div>

    <!--
	const target = [...document.querySelectorAll('c-wiz div[role="row"][aria-selected="true"]')];
	console.log('hello');
	if (target.length > 0) {
		for ( var i = 0; i < target.length; i++) {
			const cTarget = target[i];
			const driveFolderId = cTarget.parentElement.getAttribute('data-id');
			window.open("https://drive.google.com/drive/folders/" + driveFolderId, '_blank');
		}
	} else {
		window.alert('No Folder Selected');
	}
    -->


    <div class="jumbotron">
        <a id="EVERY_TIMEZONE" name="EVERY_TIMEZONE"></a>
        <div class="container">
            <h1><a href="#EVERY_TIMEZONE">Every Timezone</a></h1>
            <p>Prompts for a date time, and shows all the timezones for that time</p>
			<p>To install, drag the link below to your bookmarks bar</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var str='%s';if(str==='%'+'s'){var defaultPrompt=new Date().toLocaleString();defaultPrompt=defaultPrompt.replace(/(\d+):(\d+):\d+/,'$1:$2');str=prompt('time?',defaultPrompt);}if(str){var%20d=new%20Date(Date.parse(str));var%20dTime=d.getTime();if(isNaN(dTime)){alert('String%20is%20not%20a%20valid%20date:'+str);}else{var%20offset=new%20Date().getTimezoneOffset();var%20baseTime=((dTime/1000)-((dTime/1000)%(24*60*60))).toString(16);var%20subTime=(((dTime/1000)%(24*60*60))/60).toString(16);var%20addr='https://everytimezone.com/?t='+baseTime+','+subTime;window.open(addr,'_blank');}}else{window.open('https://everytimezone.com','_blank');}})();"
                role="button"
            >Timestamp</a></p>
        </div>
    </div>

    

    <!--

    
    custom search string:
    javascript:(function(){var str='%s';if(str){var d=new Date(Date.parse(str));var dTime=d.getTime();if(isNaN(dTime)){alert('String is not a valid date:'+str);}else{var offset=new Date().getTimezoneOffset();var baseTime=((dTime/1000)-((dTime/1000)%(24*60*60))).toString(16);var subTime=((((dTime)/1000)%(24*60*60))/60).toString(16);var addr='https://everytimezone.com/?t='+baseTime+','+subTime;window.open(addr,'_blank');}}else{window.open('https://everytimezone.com%27,%27_blank');}})();

    var str = '%s';
    if (str === '%' + 's') {
    var defaultPrompt = new Date().toLocaleString();
    defaultPrompt = defaultPrompt.replace(/(\d+):(\d+):\d+/, "$1:$2");
    str = prompt('time?', defaultPrompt);
    }
    if (str) {
        var d = new Date(Date.parse(str));
        var dTime = d.getTime();
        if (isNaN(dTime)) {
            alert('String is not a valid date:' + str);
        } else {
            var offset = new Date().getTimezoneOffset();
            var baseTime = ((dTime / 1000) - ((dTime / 1000) % (24 * 60 * 60))).toString(16);
            var subTime = (((dTime / 1000) % (24 * 60 * 60)) / 60).toString(16);
            var addr = 'https://everytimezone.com/?t=' + baseTime + ',' + subTime;
            window.open(addr, '_blank');
        }
    } else {
        window.open('https://everytimezone.com', '_blank');
    }
    -->
    
    <div class="jumbotron">
        <a id="SFDC_ID" name="SFDC_ID"></a>
        <div class="container">
            <h1><a href="#SFDC_ID">Open SalesForce ID</a></h1>
            <h3>Opens SalesForce to a particular SalesForce ID</h3>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet and enter your search term</p>
            <p class='bkmklt'><a class="btn btn-primary btn-lg" href="javascript:(function(){var isLightning=(window.location.href.indexOf('/one/one.app')>-1);var isLEX=(typeof $A!=='undefined');var sfdcId=prompt('What is the SalesForce.com ID?');if(!sfdcId){return;}var apexPage=null;var apexMatches=apexMatches=sfdcId.match('(^|/)apex/([a-zA-Z0-9_+]+)');var targetURL='/'+sfdcId;if(isLEX){try{targetURL=targetURL.replace('//','/');var evt=$A.get('e.force:navigateToURL');evt.setParams({'url':targetURL});evt.fire();return;}catch(err){alert('In LEX, but cannot navigate to URL:'+targetURL);return;}}if(isLightning){if(apexMatches){targetURL='/one/one.app#/n/'+apexMatches[2];}else{targetURL='/one/one.app#/sObject/'+sfdcId+'/view'}}var resultURL=window.location.protocol+'//'+window.location.host+targetURL;window.open(resultURL,'_blank');})();"
                role="button" 
            >Open SFDC ID</a></p>
        </div>
    </div>
    
    <div class="jumbotron">
        <a id="SEARCH_LEX" name="SEARCH_LEX"></a>
        <div class="container">
            <h1><a href="#SEARCH_LEX">Search Lightning Experience</a></h1>
			<p>Searches within LEX of your current Salesforce org</p>
			<p>Sometimes you want to do a search within Lightning Experience but don&apos;t want to lose your current screen.</p>
			<p>Launching this bookmarklet while on a Salesforce org will search for that topic in LEX in a new window.</p>
            <p>To install, drag the link below to your bookmarks bar</p>
			<p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var searchReq=prompt('what do you want to search?');var searchObj={'componentDef':'forceSearch:search','attributes':{'term':searchReq,'scopeMap':{'type':'TOP_RESULTS'},'context':{'disableSpellCorrection':false,'permsAndPrefs':{'lvmEnabledForSearchResultsOn':true}}}};var searchStr=btoa(JSON.stringify(searchObj));window.open(window.location.protocol+'//'+window.location.host+'/one/one.app#'+searchStr,'_blank');})();" 
                role="button"
            >Search LEX</a></p>
        </div>
    </div>
	
	
	
    
    <div class="jumbotron">
        <a id="SEARCH_SFDC" name="SEARCH_SFDC"></a>
        <div class="container">
            <h1><a href="#SEARCH_SFDC">Search Salesforce Data</a></h1>
            <p>Searches Salesforce for your environment</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var searchTerm=prompt('what should we search for?');window.open(window.location.protocol+'//'+window.location.host+'/_ui/search/ui/UnifiedSearchResults?searchType=2&amp;str='+searchTerm,'_blank');})();" 
                role="button"
            >Search SFDC</a></p>
        </div>
    </div>
    
    
    
    
    <div class="jumbotron">
        <a id="SEARCH_SETUP" name="SEARCH_SETUP"></a>
        <div class="container">
            <h1><a href="#SEARCH_SETUP">Search Setup</a></h1>
            <p>Searches Salesforce Setup for terms</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var searchTerm=prompt('what should we search for?');window.open(window.location.protocol+'//'+window.location.host+'/ui/setup/SetupSearchResultsPage?setupSearch='+searchTerm,'_blank');})();" 
                role="button"
            >Search Setup</a></p>
        </div>
    </div>
    
    
    
    
    
    
    <div class="jumbotron">
        <a id="SETUP" name="SETUP"></a>
        <div class="container">
            <h1><a href="#SETUP">Classic Setup</a></h1>
            <p>Navigates to the classic settings</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet and enter your search term</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var url=window.location.protocol+'//'+window.location.host+'/p/setup/custent/CustomObjectsPage?setupid=CustomObjects';var win=window.open(url,'_blank');function checkWin(){if(win.document){win.document.title=UserContext.userName;}else{setTimeout(checkWin,5000);}}setTimeout(checkWin,5000);})();" 
                role="button"
            >Classic Setup</a></p>
        </div>
    </div>
    
    
    
    <div class="jumbotron">
        <a id="LIGHTNING_SETUP" name="LIGHTNING_SETUP"></a>
        <div class="container">
            <h1><a href="#LIGHTNING_SETUP">Lightning Setup</a></h1>
            <p>Navigates to the Lightning Experience settings - assuming you're in Lightning Experience</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet and enter your search term</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var url=window.location.protocol+'//'+window.location.host+'/one/one.app#/setup/home';var win=window.open(url,'_blank');})();" 
                role="button">Lightning Setup</a></p>
        </div>
    </div>
    
    
    
    <div class="jumbotron">
        <a id="AC_STUDIO" name="AC_STUDIO"></a>
        <div class="container">
            <h1><a href="#AC_STUDIO">Open AC Studio</a></h1>
            <p>Navigates to Salesforce Analytics Studio - assuming it is available in your org</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet when somewhere in your salesforce org.</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var url=window.location.protocol+'//'+window.location.host+'/analytics/wave/wave.apexp#home';var win=window.open(url,'_blank');function checkWin(){if(win.document){win.document.title=UserContext.userName;}else{setTimeout(checkWin,5000);}}setTimeout(checkWin,5000);})();" 
                role="button"
            >Open AC Studio</a></p>
        </div>
    </div>
    
    
    
    <div class="jumbotron">
        <a id="LIGHTNING_SETUP" name="LIGHTNING_APP_BUILDER"></a>
        <div class="container">
            <h1><a href="#LIGHTNING_APP_BUILDER">Lightning App Builder</a></h1>
            <p>Navigates to the Lightning App Builder</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then navigate to an area in Salesforce with Lightning Experience enabled, and simply tap the bookmarklet</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var url=window.location.protocol+'//'+window.location.host+'/one/one.app#/setup/FlexiPageList/home';var win=window.open(url,'_blank');})();" 
                role="button"
            >App Builder</a></p>
        </div>
    </div>
    
    
    
    <!--
    <div class="jumbotron">
        <a id="RALLY_TASK_STORY" name="SEARCH_RALLY"></a>
        <div class="container">
            <h1><a href="#RALLY_TASK_STORY">Rally Task Fix</a></h1>
            <h1>UPDATE: this may not be needed anymore with recent rally update 1/24/2017. YAY!</h1>
            <p>Rally Tasks and Story<br />at the SAME TIME</p>
            <h3>Its a magical concept.</h3>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then, when you're on a rally story detail, click the button</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function()%7Burl2%3D&quot;http://mm-proth.s3.amazonaws.com/bookmarklets/rallyFixTarget.html&quot;%3BopenWindow%3Dwindow.open(url2%2B&quot;%3Ff1%3D&quot;%2Bwindow.location.href%2B&quot;%26f2%3D&quot;%2Bwindow.location.href%2B&quot;/tasks&quot;,&quot;RallyFix&quot;,&quot;&quot;)%3B%7D)()%3B" 
                role="button"
            >Rally Task Fix</a></p>
        </div>
    </div>
    -->
    
    
    <div class="jumbotron">
        <a id="SWAP_SFDC_USER" name="SWAP_SFDC_USER"></a>
        <div class="container">
            <h1><a href="#SWAP_SFDC_USER">Swap SFDC User</a></h1>
            <p>Swaps betten the User Chatter page and their User Info page (used for login)</p>
            <p>To install, drag the link below to your bookmarks bar</p>
            <p>Then simply tap the bookmarklet and enter your search term</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){originalLocation = window.location.href.replace( '/UserProfilePage?', '/upp?' ); newLocation1=originalLocation.replace( /\/([a-zA-Z0-9]{15,18})[?&amp;].*/, '/_ui/core/userprofile/UserProfilePage?u=$1' ); newLocation2=originalLocation.replace( /[?&amp;]u=([a-zA-Z0-9]{15,})\&amp;.+/g, '%E2%80%A0$1?noredirect=1' ).replace( /\/_ui\/core\/[^%E2%80%A0]+%E2%80%A0/g, '/' ); if( newLocation1 != originalLocation ){   window.location.href=newLocation1; } else if( newLocation2 != originalLocation ){ window.location.href=newLocation2; } })()" 
                role="button"
            >Swap SFDC User</a></p>
        </div>
    </div>
	
    
    <div class="jumbotron">
        <a id="VIEW_ALL_PER_PAGE" name="VIEW_ALL_PER_PAGE"></a>
        <div class="container">
            <h1><a href="#VIEW_ALL_PER_PAGE">View All per Page</a></h1>
            <p>If on a page that says 'see more', you want to see 1k per page instead - this bookmarklet is for you.</p>
			<p>To install, drag the link below to your bookmarks bar</p>
			<p>For now, you will have to click on the 'see more' link at least once before clicking,
				as a couple pages in salesforce have special parameters (like the rowsperpage attribute)
				that aren't shown until then.</p>
			<p>This bookmarklet needs that parameter (and all the other hidden special ones) to work correctly</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var loc=window.location.href;var rowsPerPagePattern=/([%][2][6]rowsperpage[%][3][D])(\d+)([%][2][6])/i;var loc2=loc.replace(rowsPerPagePattern,function(matchStr,p1,p2,p3,offset,fullStr){return(p1+1000+p3);});window.location.href=loc2;})();"
                role="button"
            >View All per Page</a></p>
        </div>
    </div>	
    
    <div class="jumbotron">
        <a id="VIDYARD_TIMESTAMP" name="VIDYARD_TIMESTAMP"></a>
        <div class="container">
            <h1><a href="#VIDYARD_TIMESTAMP">Vidyard Timestamp</a></h1>
            <p>Navigates to a specific seconds offset in a vidyard video.</p>
			<p>To install, drag the link below to your bookmarks bar</p>
			<p>Then, click the bookmark when on a vidyard video, fill in the seconds offset</p>
            <p class="bkmklt"><a class="btn btn-primary btn-lg" href="javascript:(function(){var explorer=null;function getVidyardVideo(v){var result=null;for(var prop in v){if(v.hasOwnProperty(prop)&&typeof(v[prop])=='object'){return(v[prop]);}}return(null);}try{var vidPlayer=new Vidyard.players();window.vidyardExplorer=getVidyardVideo(vidPlayer);explorer=window.vidyardExplorer;}catch(err){alert('could not find vidyard explorer');}if(explorer){try{var timecodeStr=prompt('Video timestamp');var timecode=parseInt(timecodeStr);if(timecode){explorer.seek(timecode);}else{alert('invalid timecode:'+timecode);}}catch(err){alert('could not navigate video');}}})();"
                role="button"
            >Vidyard Timestamp</a></p>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</body></html>
